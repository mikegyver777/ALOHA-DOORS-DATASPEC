<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Aloha Doors - Door Order System</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Arial, sans-serif; background: #f5f5f5; padding: 20px; line-height: 1.6; }
        .container { max-width: 1500px; margin: 0 auto; }
        .header { background: linear-gradient(135deg, #8B0000, #DC143C); color: white; padding: 20px 30px; border-radius: 12px; margin-bottom: 20px; display: flex; justify-content: space-between; align-items: center; flex-wrap: wrap; gap: 15px; }
        .logo-section { display: flex; align-items: center; gap: 15px; }
        .logo-icon { font-size: 40px; }
        .logo-text { font-size: 28px; font-weight: bold; letter-spacing: 2px; }
        .logo-subtitle { font-size: 12px; opacity: 0.9; letter-spacing: 1px; }
        .header-actions { display: flex; gap: 10px; flex-wrap: wrap; }
        .btn { padding: 10px 20px; border: none; border-radius: 8px; cursor: pointer; font-size: 14px; font-weight: 600; transition: all 0.2s; display: inline-flex; align-items: center; gap: 6px; }
        .btn-primary { background: white; color: #8B0000; }
        .btn-primary:hover { background: #f0f0f0; }
        .btn-success { background: #16a34a; color: white; }
        .btn-success:hover { background: #15803d; }
        .btn-blue { background: #2563eb; color: white; }
        .btn-blue:hover { background: #1d4ed8; }
        .btn-danger { background: #dc2626; color: white; padding: 6px 12px; font-size: 12px; }
        .btn-outline { background: transparent; border: 2px solid #e5e7eb; color: #374151; }
        .btn-outline:hover { border-color: #8B0000; color: #8B0000; }
        .btn-sm { padding: 6px 12px; font-size: 12px; }
        .tabs-container { background: white; padding: 15px 20px; border-radius: 12px; margin-bottom: 20px; box-shadow: 0 2px 8px rgba(0,0,0,0.1); }
        .tabs { display: flex; gap: 8px; flex-wrap: wrap; align-items: center; }
        .tab { display: flex; align-items: center; gap: 5px; }
        .tab-btn { padding: 10px 16px; border: none; background: #e5e7eb; color: #374151; cursor: pointer; font-weight: 600; border-radius: 8px; transition: all 0.2s; font-size: 14px; }
        .tab-btn.active { background: #8B0000; color: white; }
        .tab-btn:hover:not(.active) { background: #d1d5db; }
        .tab-qty { background: rgba(255,255,255,0.3); padding: 2px 8px; border-radius: 10px; font-size: 11px; margin-left: 5px; }
        .main-grid { display: grid; grid-template-columns: 1fr 400px; gap: 20px; }
        @media (max-width: 1100px) { .main-grid { grid-template-columns: 1fr; } }
        .card { background: white; padding: 20px; border-radius: 12px; box-shadow: 0 2px 8px rgba(0,0,0,0.1); margin-bottom: 20px; }
        .card h2 { font-size: 16px; color: #1a1a1a; margin-bottom: 15px; padding-bottom: 10px; border-bottom: 2px solid #8B0000; display: flex; align-items: center; gap: 8px; }
        .form-row { display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 12px; margin-bottom: 12px; }
        .form-group { display: flex; flex-direction: column; gap: 4px; }
        label { font-size: 11px; font-weight: 600; color: #6b7280; text-transform: uppercase; letter-spacing: 0.5px; }
        input, select, textarea { width: 100%; padding: 8px 10px; border: 2px solid #e5e7eb; border-radius: 6px; font-size: 14px; transition: border 0.2s; }
        input:focus, select:focus, textarea:focus { outline: none; border-color: #8B0000; }
        textarea { resize: vertical; min-height: 80px; }
        .help-text { font-size: 11px; color: #9ca3af; }
        .pricing-row { display: grid; grid-template-columns: 1fr 80px 1fr 1fr; gap: 8px; align-items: end; padding: 10px; background: #f9fafb; border-radius: 6px; margin-bottom: 8px; }
        .pricing-row .cost-input { background: #fef3c7; }
        .pricing-row .markup-input { background: #e0f2fe; }
        .pricing-row .sell-price { background: #d1fae5; font-weight: 600; }
        .pricing-row .labor-input { background: #fce7f3; }
        .summary-panel { position: sticky; top: 20px; }
        .summary-header { background: #8B0000; color: white; padding: 15px; border-radius: 12px 12px 0 0; margin: -20px -20px 15px -20px; }
        .summary-header h2 { color: white; border: none; margin: 0; padding: 0; }
        .quantity-display { background: linear-gradient(135deg, #1e40af, #3b82f6); color: white; padding: 15px; border-radius: 8px; text-align: center; margin-bottom: 15px; }
        .quantity-display .qty-number { font-size: 36px; font-weight: bold; }
        .quantity-display .qty-label { font-size: 12px; opacity: 0.9; }
        .summary-item { border-left: 3px solid #8B0000; padding: 10px 12px; margin-bottom: 10px; background: #fafafa; border-radius: 0 6px 6px 0; }
        .summary-category { font-size: 10px; font-weight: 700; color: #8B0000; text-transform: uppercase; }
        .summary-item-name { font-size: 14px; font-weight: 600; color: #1a1a1a; margin: 3px 0; }
        .summary-details { font-size: 12px; color: #6b7280; }
        .summary-price { font-size: 13px; font-weight: 600; color: #16a34a; margin-top: 4px; }
        .totals-section { border-top: 2px solid #e5e7eb; padding-top: 15px; margin-top: 15px; }
        .total-row { display: flex; justify-content: space-between; padding: 6px 0; font-size: 14px; }
        .total-row.subtotal { color: #6b7280; }
        .total-row.grand-total { font-size: 20px; font-weight: bold; color: #1a1a1a; border-top: 2px solid #1a1a1a; padding-top: 10px; margin-top: 5px; }
        .hardware-list { border: 1px solid #e5e7eb; border-radius: 8px; overflow: hidden; }
        .hardware-item { padding: 12px; border-bottom: 1px solid #e5e7eb; background: #fafafa; }
        .hardware-item:last-child { border-bottom: none; }
        .hardware-item-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px; }
        .hardware-item-title { font-weight: 600; font-size: 13px; color: #374151; }
        .modal-overlay { position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: rgba(0,0,0,0.5); display: flex; justify-content: center; align-items: center; z-index: 1000; opacity: 0; visibility: hidden; transition: all 0.3s; }
        .modal-overlay.active { opacity: 1; visibility: visible; }
        .modal { background: white; border-radius: 12px; max-width: 900px; width: 95%; max-height: 90vh; overflow: hidden; display: flex; flex-direction: column; }
        .modal-header { padding: 20px; background: #8B0000; color: white; display: flex; justify-content: space-between; align-items: center; }
        .modal-header h2 { color: white; margin: 0; border: none; padding: 0; }
        .modal-close { background: none; border: none; color: white; font-size: 24px; cursor: pointer; }
        .modal-body { padding: 20px; overflow-y: auto; flex: 1; }
        .modal-footer { padding: 15px 20px; border-top: 1px solid #e5e7eb; display: flex; justify-content: flex-end; gap: 10px; }
        @media print { .no-print { display: none !important; } }
        .mt-10 { margin-top: 10px; }
        
        /* Data Specs Styles */
        .spec-item { border: 1px solid #e5e7eb; border-radius: 8px; padding: 12px; margin-bottom: 12px; background: #fafafa; }
        .spec-item-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px; }
        .spec-item-title { font-weight: 600; font-size: 13px; color: #8B0000; }
        .spec-item-content { display: grid; grid-template-columns: 150px 1fr; gap: 12px; }
        .spec-image-area { min-height: 100px; border: 2px dashed #d1d5db; border-radius: 6px; display: flex; align-items: center; justify-content: center; background: white; overflow: hidden; }
        .spec-image-area img { max-width: 100%; max-height: 120px; object-fit: contain; }
        .spec-image-area.empty { color: #9ca3af; font-size: 12px; text-align: center; padding: 10px; cursor: pointer; }
        .spec-image-area.empty:hover { border-color: #8B0000; color: #8B0000; }
        .spec-notes textarea { min-height: 80px; font-size: 12px; }
    </style>
</head>
<body>
<div class="container">
    <div class="header no-print">
        <div class="logo-section">
            <div>
                <div class="logo-text">ALOHA DOORS</div>
                <div class="logo-subtitle">214 Main St. #119, El Segundo CA 90245 ‚Ä¢ (310) 414-0488 ‚Ä¢ alohadoors.com</div>
            </div>
        </div>
        <div class="header-actions">
            <button class="btn btn-primary" onclick="printSpecSheet()">üñ®Ô∏è Print</button>
            <button class="btn btn-primary" onclick="saveSpecSheet()">üíæ Save</button>
            <button class="btn btn-primary" onclick="openEmailModal()">üìß Email</button>
            <button class="btn btn-primary" onclick="copyOrderText()">üìã Copy</button>
            <input type="file" id="importFile" accept=".json" style="display:none" onchange="importJSON(event)">
            <button class="btn btn-success" onclick="addNewDoor()">‚ûï Add Door</button>
        </div>
    </div>

    <div class="tabs-container no-print">
        <div class="tabs" id="doorTabs"></div>
    </div>

    <div class="main-grid">
        <div id="configPanel" class="no-print">
            <div class="card">
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px;">
                    <h2 style="margin: 0;"><span class="icon">üìã</span> Job Information</h2>
                    <div style="display: flex; gap: 8px; align-items: center;">
                        <select id="presetSelector" onchange="loadPreset(this.value)" style="padding: 8px 12px; border-radius: 6px; border: 1px solid #d1d5db; font-size: 13px; min-width: 180px;">
                            <option value="">‚Äî Load Preset ‚Äî</option>
                        </select>
                        <button class="btn btn-success btn-sm" onclick="openSavePresetModal()" style="white-space: nowrap;">üíæ Save Preset</button>
                        <button class="btn btn-danger btn-sm" onclick="deleteCurrentPreset()" style="white-space: nowrap;">üóëÔ∏è</button>
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-group"><label>Estimate #</label><input type="text" id="estimateNumber" onchange="updateJobInfo()"></div>
                    <div class="form-group"><label>Date</label><input type="date" id="estimateDate" onchange="updateJobInfo()"></div>
                    <div class="form-group"><label>Customer Name</label><input type="text" id="customerName" placeholder="Customer / Company Name" onchange="updateJobInfo()"></div>
                    <div class="form-group"><label>Job Reference</label><input type="text" id="jobReference" placeholder="Project Name / PO#" onchange="updateJobInfo()"></div>
                </div>
                <div class="form-row">
                    <div class="form-group" style="flex: 2;"><label>Job Site Address</label><input type="text" id="jobAddress" placeholder="123 Main St, City, State ZIP" onchange="updateJobInfo()"></div>
                    <div class="form-group" style="flex: 2;">
                        <label>Delivery Address</label>
                        <div style="display: flex; gap: 10px; align-items: center;">
                            <input type="text" id="deliveryAddress" placeholder="Leave blank if same as job site" onchange="updateJobInfo(); document.getElementById('sameAsJobSite').checked = false;" style="flex: 1;">
                            <label style="display: flex; align-items: center; gap: 5px; font-size: 12px; white-space: nowrap; cursor: pointer;"><input type="checkbox" id="sameAsJobSite" onchange="copyJobSiteToDelivery()"> Same as Job Site</label>
                        </div>
                    </div>
                </div>
            </div>

            <div class="card">
                <h2><span class="icon">üö™</span> Door Information</h2>
                <div class="form-row">
                    <div class="form-group"><label>Quantity</label><input type="number" id="doorQuantity" value="1" min="1" onchange="updateQuantity()"><span class="help-text">How many of this door</span></div>
                    <div class="form-group"><label>Width (in)</label><input type="number" id="doorWidth" placeholder="36" onchange="updateDoor()"></div>
                    <div class="form-group"><label>Height (in)</label><input type="number" id="doorHeight" placeholder="84" onchange="updateDoor()"></div>
                    <div class="form-group"><label>Thickness</label><select id="doorThickness" onchange="updateDoor()"><option value="1-3/8">1-3/8"</option><option value="1-3/4" selected>1-3/4"</option><option value="2">2"</option></select></div>
                </div>
                <div class="form-row">
                    <div class="form-group"><label>Door Type</label><select id="doorType" onchange="updateDoorType()"><option value="">-- Select --</option><optgroup label="HM (Hollow Metal)"><option value="HM-3HR">HM - 3 Hour Fire Rated</option><option value="HM-90">HM - 90 Min Fire Rated</option><option value="HM-45">HM - 45 Min Fire Rated</option><option value="HM-20">HM - 20 Min Fire Rated</option><option value="HM-STD">HM - Non-Rated</option></optgroup><optgroup label="Specialty"><option value="RF">RF Shielded Door</option><option value="STC">STC Acoustic Door</option></optgroup><optgroup label="WD (Wood)"><option value="WD-PAINT">WD - Paint Grade</option><option value="WD-STAIN">WD - Stain Grade</option><option value="WD-LAM">WD - Laminate</option></optgroup><option value="OTHER">Other</option></select><input type="text" id="doorTypeManual" placeholder="Enter door type..." style="display:none; margin-top:6px;" onchange="updateDoor()"></div>
                    <div class="form-group"><label>Brand</label><select id="doorBrand" onchange="updateDoorBrand()"><option value="">-- Select --</option></select><input type="text" id="doorBrandManual" placeholder="Enter brand..." style="display:none; margin-top:6px;" onchange="updateDoor()"></div>
                    <div class="form-group"><label>Model/Series</label><select id="doorModel" onchange="updateDoorModel()"><option value="">-- Select --</option></select><input type="text" id="doorModelManual" placeholder="Enter model..." style="display:none; margin-top:6px;" onchange="updateDoor()"></div>
                </div>
                <div class="form-row">
                    <div class="form-group"><label>Fire Rating</label><select id="doorFireRating" onchange="updateDoor()"><option value="None">None</option><option value="20-min">20 Min</option><option value="45-min">45 Min</option><option value="60-min">60 Min</option><option value="90-min">90 Min</option><option value="3-hr">3 Hour</option></select></div>
                    <div class="form-group"><label>Handing</label><select id="doorHanding" onchange="updateDoor()"><option value="LH">LH - Left Hand</option><option value="RH">RH - Right Hand</option><option value="LHR">LHR - Left Hand Reverse</option><option value="RHR">RHR - Right Hand Reverse</option></select></div>
                    <div class="form-group"><label>Swing</label><select id="doorSwing" onchange="updateDoor()"><option value="Inswing">Inswing</option><option value="Outswing">Outswing</option></select></div>
                </div>
                <div class="pricing-row">
                    <div class="form-group"><label>Your Cost</label><input type="number" id="doorCost" class="cost-input" placeholder="0.00" step="0.01" onchange="updateDoor()"></div>
                    <div class="form-group"><label>Markup %</label><input type="number" id="doorMarkup" class="markup-input" value="30" step="1" onchange="updateDoor()"></div>
                    <div class="form-group"><label>Sell Price</label><input type="text" id="doorSellPrice" class="sell-price" readonly></div>
                    <div class="form-group"><label>Labor</label><input type="number" id="doorLabor" class="labor-input" placeholder="0.00" step="0.01" onchange="updateDoor()"></div>
                </div>
            </div>

            <div class="card">
                <h2><span class="icon">üî≤</span> Frame</h2>
                <div class="form-row">
                    <div class="form-group"><label>Frame Type</label><select id="frameType" onchange="updateFrameType()"><option value="">-- Select --</option><optgroup label="KD Frames"><option value="KD-DW-16">KD - Drywall 16 Ga.</option><option value="KD-DW-14">KD - Drywall 14 Ga.</option><option value="KD-MASONRY">KD - Masonry/Block</option><option value="KD-EXIST">KD - Existing Opening</option></optgroup><optgroup label="Welded Frames"><option value="WLD-DW">Welded - Drywall</option><option value="WLD-MASONRY">Welded - Masonry/CMU</option><option value="WLD-CONCRETE">Welded - Concrete</option></optgroup><optgroup label="Configurations"><option value="SINGLE">Single Door Frame</option><option value="PAIR">Pair Frame</option><option value="SL-1">Single + 1 Sidelite</option><option value="DBL-EGRESS">Double Egress</option></optgroup><option value="OTHER">Other</option></select><input type="text" id="frameTypeManual" placeholder="Enter frame type..." style="display:none; margin-top:6px;" onchange="updateDoor()"></div>
                    <div class="form-group"><label>Brand</label><select id="frameBrand" onchange="updateFrameBrand()"><option value="">-- Select --</option></select><input type="text" id="frameBrandManual" placeholder="Enter brand..." style="display:none; margin-top:6px;" onchange="updateDoor()"></div>
                    <div class="form-group"><label>Model/Series</label><select id="frameModel" onchange="updateFrameModel()"><option value="">-- Select --</option></select><input type="text" id="frameModelManual" placeholder="Enter model..." style="display:none; margin-top:6px;" onchange="updateDoor()"></div>
                </div>
                <div class="form-row">
                    <div class="form-group"><label>Frame Material</label><select id="frameMaterial" onchange="updateDoor()"><option value="HM-16">HM 16 Ga.</option><option value="HM-14">HM 14 Ga.</option><option value="HM-12">HM 12 Ga.</option><option value="WD">Wood</option><option value="AL">Aluminum</option><option value="SS">Stainless Steel</option></select></div>
                    <div class="form-group"><label>Anchors</label><select id="frameAnchors" onchange="updateDoor()"><option value="Masonry-T">Masonry T-Anchor</option><option value="Steel-Stud">Steel Stud</option><option value="Wood-Stud">Wood Stud</option><option value="Compression">Compression</option><option value="Existing">Existing</option></select></div>
                    <div class="form-group"><label>Jamb Depth</label><select id="frameJambDepth" onchange="updateDoor()"><option value="4-3/4">4-3/4" (Std Drywall)</option><option value="5-3/4">5-3/4"</option><option value="6-3/4">6-3/4"</option><option value="8-3/4">8-3/4" (Masonry)</option></select></div>
                    <div class="form-group"><label>Head/Strike Prep</label><select id="framePrep" onchange="updateDoor()"><option value="STD">Standard (161)</option><option value="MORTISE">Mortise Lock</option><option value="DEADBOLT">Deadbolt</option><option value="ELECTRIC">Electric Strike</option><option value="NONE">No Prep</option></select></div>
                </div>
                <div class="pricing-row">
                    <div class="form-group"><label>Your Cost</label><input type="number" id="frameCost" class="cost-input" placeholder="0.00" step="0.01" onchange="updateDoor()"></div>
                    <div class="form-group"><label>Markup %</label><input type="number" id="frameMarkup" class="markup-input" value="30" step="1" onchange="updateDoor()"></div>
                    <div class="form-group"><label>Sell Price</label><input type="text" id="frameSellPrice" class="sell-price" readonly></div>
                    <div class="form-group"><label>Labor</label><input type="number" id="frameLabor" class="labor-input" placeholder="0.00" step="0.01" onchange="updateDoor()"></div>
                </div>
            </div>

            <div class="card">
                <h2><span class="icon">üîß</span> Hardware</h2>
                <div class="hardware-list" id="hardwareList"></div>
                <button class="btn btn-outline btn-sm mt-10" onclick="addHardwareItem()">+ Add Hardware</button>
            </div>

            <div class="card">
                <h2><span class="icon">üìù</span> Notes</h2>
                <textarea id="doorNotes" placeholder="Special instructions or requirements..." onchange="updateDoor()"></textarea>
            </div>

            <!-- DATA SPECS SECTION -->
            <div class="card">
                <h2><span class="icon">üìã</span> Data Spec Sheets</h2>
                
                <!-- Quantity Display -->
                <div style="background: linear-gradient(135deg, #1e40af, #3b82f6); color: white; padding: 15px; border-radius: 8px; margin-bottom: 15px; display: flex; justify-content: space-between; align-items: center;">
                    <div>
                        <div style="font-size: 12px; opacity: 0.9;">QUANTITY FOR THIS CONFIGURATION</div>
                        <div style="font-size: 28px; font-weight: bold;" id="specQtyDisplay">1</div>
                    </div>
                    <div style="text-align: right;">
                        <label style="font-size: 10px; color: white; opacity: 0.9;">ADJUST QTY</label>
                        <input type="number" id="specQtyInput" value="1" min="1" style="width: 80px; padding: 8px; font-size: 18px; font-weight: bold; text-align: center; border: none; border-radius: 6px;" onchange="updateQtyFromSpecs(this.value)">
                    </div>
                </div>
                
                <p style="font-size:12px; color:#6b7280; margin-bottom:15px;">Upload images and notes for this door configuration. These will appear on printed spec sheets and are saved with configurations.</p>
                
                <div id="dataSpecsContainer">
                    <!-- DOOR SPECIFICATIONS CATEGORY -->
                    <div style="background: #8B0000; color: white; padding: 8px 15px; border-radius: 6px; margin-bottom: 10px; font-weight: bold; font-size: 13px;">
                        üö™ DOOR SPECIFICATIONS
                    </div>
                    <div class="spec-item">
                        <div class="spec-item-header">
                            <span class="spec-item-title">Door Spec Sheet</span>
                        </div>
                        <div class="spec-item-content">
                            <div class="spec-image-area empty" id="doorSpecImage" onclick="document.getElementById('doorSpecImageInput').click()">
                                Click to upload image
                            </div>
                            <input type="file" id="doorSpecImageInput" accept="image/*" style="display:none" onchange="handleSpecImageUpload('door', event)">
                            <div class="spec-notes">
                                <textarea id="doorSpecNotes" placeholder="Door technical specifications..." onchange="updateSpecNotes('door')"></textarea>
                            </div>
                        </div>
                    </div>

                    <!-- FRAME SPECIFICATIONS CATEGORY -->
                    <div style="background: #8B0000; color: white; padding: 8px 15px; border-radius: 6px; margin: 15px 0 10px; font-weight: bold; font-size: 13px;">
                        üî≤ FRAME SPECIFICATIONS
                    </div>
                    <div class="spec-item">
                        <div class="spec-item-header">
                            <span class="spec-item-title">Frame Spec Sheet</span>
                        </div>
                        <div class="spec-item-content">
                            <div class="spec-image-area empty" id="frameSpecImage" onclick="document.getElementById('frameSpecImageInput').click()">
                                Click to upload image
                            </div>
                            <input type="file" id="frameSpecImageInput" accept="image/*" style="display:none" onchange="handleSpecImageUpload('frame', event)">
                            <div class="spec-notes">
                                <textarea id="frameSpecNotes" placeholder="Frame technical specifications..." onchange="updateSpecNotes('frame')"></textarea>
                            </div>
                        </div>
                    </div>

                    <!-- HARDWARE SPECIFICATIONS CATEGORY -->
                    <div style="background: #8B0000; color: white; padding: 8px 15px; border-radius: 6px; margin: 15px 0 10px; font-weight: bold; font-size: 13px;">
                        üîß HARDWARE SPECIFICATIONS
                    </div>
                    <div id="hardwareSpecsContainer"></div>
                </div>
            </div>
        </div>

        <div class="summary-panel no-print">
            <div class="card">
                <div class="summary-header"><h2>üìã <span id="summaryDoorLabel">Customer</span></h2><div id="summaryJobRef" style="font-size: 14px; color: white; margin-top: 4px; font-weight: 600;"></div></div>
                <div id="summaryContent"></div>
                <div class="totals-section">
                    <div class="total-row subtotal"><span>Materials:</span><span id="materialsSubtotal">$0.00</span></div>
                    <div class="total-row subtotal"><span>Labor:</span><span id="laborSubtotal">$0.00</span></div>
                    <div class="total-row subtotal"><span>Door Total (√ó<span id="qtyMultiplier">1</span>):</span><span id="doorTotal">$0.00</span></div>
                    <div class="total-row grand-total"><span>All Doors:</span><span id="grandTotal">$0.00</span></div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Configs Modal -->
<!-- Email Modal -->
<div class="modal-overlay" id="emailModal">
    <div class="modal" style="max-width:550px;">
        <div class="modal-header"><h2>üìß Email Invoice & Specs</h2><button class="modal-close" onclick="closeEmailModal()">&times;</button></div>
        <div class="modal-body">
            <p style="color:#6b7280; margin-bottom:15px; font-size:13px;">Send the invoice and specification sheets via email. The spec sheet will be downloaded automatically for you to attach.</p>
            
            <div class="form-group" style="margin-bottom:15px;">
                <label style="font-weight:600;">Recipient Email</label>
                <input type="email" id="emailTo" placeholder="supplier@example.com" style="width:100%; padding:12px; border:1px solid #d1d5db; border-radius:6px; font-size:14px;">
            </div>
            
            <div class="form-group" style="margin-bottom:15px;">
                <label style="font-weight:600;">CC (optional)</label>
                <input type="email" id="emailCc" placeholder="manager@company.com" style="width:100%; padding:12px; border:1px solid #d1d5db; border-radius:6px; font-size:14px;">
            </div>
            
            <div class="form-group" style="margin-bottom:15px;">
                <label style="font-weight:600;">Subject</label>
                <input type="text" id="emailSubject" style="width:100%; padding:12px; border:1px solid #d1d5db; border-radius:6px; font-size:14px;">
            </div>
            
            <div class="form-group" style="margin-bottom:15px;">
                <label style="font-weight:600;">Message</label>
                <textarea id="emailBody" rows="6" style="width:100%; padding:12px; border:1px solid #d1d5db; border-radius:6px; font-size:14px; resize:vertical;"></textarea>
            </div>
            
            <div style="background:#fef3c7; border:1px solid #f59e0b; border-radius:6px; padding:12px; font-size:12px; color:#92400e;">
                <strong>üìé Attachment:</strong> When your email client opens, please attach the spec sheet file that will be downloaded automatically.
            </div>
        </div>
        <div class="modal-footer">
            <button class="btn btn-outline" onclick="closeEmailModal()">Cancel</button>
            <button class="btn btn-success" onclick="sendEmail()">üìß Open Email Client</button>
        </div>
    </div>
</div>

<!-- Save Preset Modal -->
<div class="modal-overlay" id="savePresetModal">
    <div class="modal" style="max-width:500px;">
        <div class="modal-header"><h2>üíæ Save Door Preset</h2><button class="modal-close" onclick="closeSavePresetModal()">&times;</button></div>
        <div class="modal-body">
            <p style="color:#6b7280; margin-bottom:15px; font-size:13px;">Save this door configuration as a reusable preset. Includes door specs, frame specs, hardware, and images. Job info and quantity are NOT saved.</p>
            <div class="form-group">
                <label style="font-weight:600;">Preset Name</label>
                <input type="text" id="presetName" placeholder="e.g., 3HR Fire Door 36x84 w/ Panic" style="width:100%; padding:12px; border:1px solid #d1d5db; border-radius:6px; font-size:14px;">
            </div>
            <div id="presetPreview" style="background:#f9fafb; border:1px solid #e5e7eb; border-radius:6px; padding:12px; margin-top:15px; font-size:12px; max-height:200px; overflow-y:auto;">
                <!-- Preview will be populated -->
            </div>
        </div>
        <div class="modal-footer">
            <button class="btn btn-outline" onclick="closeSavePresetModal()">Cancel</button>
            <button class="btn btn-success" onclick="savePreset()">üíæ Save Preset</button>
        </div>
    </div>
</div>

<div class="modal-overlay" id="configModal">
    <div class="modal" style="max-width:700px;">
        <div class="modal-header"><h2>üì¶ Saved Configurations</h2><button class="modal-close" onclick="closeConfigModal()">&times;</button></div>
        <div class="modal-body">
            <div style="display:flex; gap:15px; margin-bottom:20px; padding-bottom:20px; border-bottom:1px solid #e5e7eb;">
                <input type="text" id="configName" placeholder="Configuration name..." style="flex:1; padding:10px; border:1px solid #d1d5db; border-radius:6px;">
                <button class="btn btn-success" onclick="saveCurrentConfig()">üíæ Save Current</button>
            </div>
            <h4 style="margin-bottom:15px; color:#374151;">Saved Configurations</h4>
            <div id="savedConfigsList" style="max-height:400px; overflow-y:auto;"><p style="color:#9ca3af; text-align:center; padding:20px;">No saved configurations</p></div>
        </div>
        <div class="modal-footer"><button class="btn btn-outline" onclick="closeConfigModal()">Close</button></div>
    </div>
</div>

<script>
const AppState = { job: { estimateNumber: '', estimateDate: '', customerName: '', jobReference: '', jobAddress: '', deliveryAddress: '' }, doors: [], activeIndex: 0 };

const BrandLibrary = {
    doors: { 'Ceco Door': ['Standard', 'Imperial', 'Storm'], 'Curries': ['707', '747'], 'Steelcraft': ['L-Series', 'B-Series'], 'Republic': ['Standard', 'Heavy Duty'], 'Masonite': ['Safe N Sound', 'Solidoor'], 'VT Industries': ['VT1000', 'VT5000'], 'Other': ['Manual Entry'] },
    frames: { 'Ceco Door': ['KD Series', 'Welded'], 'Curries': ['665', '767'], 'Steelcraft': ['F-Series', 'WF-Series'], 'Timely': ['Classic', 'Prefinished'], 'Other': ['Manual Entry'] },
    hardware: { 'Von Duprin': ['98/99', '22 Series', '33A/35A'], 'Schlage': ['AL Series', 'ND Series', 'L9000'], 'Norton': ['8500', '8000', '7500'], 'LCN': ['4041', '4040XP'], 'Best': ['9K', '45H', 'IC Core'], 'Hager': ['4300', '5200'], 'Ives': ['FB31', 'FB41'], 'Pemko': ['Thresholds', 'Door Bottoms'], 'Other': ['Manual Entry'] }
};

const HardwareCatalog = [
    { id: 'lockset', label: 'Lockset', defaultBrand: 'Schlage', defaultModel: 'ND Series' },
    { id: 'panic-rim', label: 'Panic Bar - Rim', defaultBrand: 'Von Duprin', defaultModel: '98/99' },
    { id: 'panic-cvr', label: 'Panic Bar - CVR', defaultBrand: 'Von Duprin', defaultModel: '22 Series' },
    { id: 'closer', label: 'Door Closer', defaultBrand: 'LCN', defaultModel: '4041' },
    { id: 'hinges', label: 'Hinges (Set)', defaultBrand: 'Hager', defaultModel: '4300' },
    { id: 'flush-manual', label: 'Manual Flush Bolts', defaultBrand: 'Ives', defaultModel: 'FB31' },
    { id: 'flush-auto', label: 'Auto Flush Bolts', defaultBrand: 'Ives', defaultModel: 'FB41' },
    { id: 'cylinder', label: 'IC Cylinder', defaultBrand: 'Best', defaultModel: 'IC Core' },
    { id: 'threshold', label: 'Threshold', defaultBrand: 'Pemko', defaultModel: 'Thresholds' },
    { id: 'stop', label: 'Door Stop', defaultBrand: 'Ives', defaultModel: 'Manual Entry' },
    { id: 'other', label: 'Other Hardware', defaultBrand: 'Other', defaultModel: 'Manual Entry' }
];

const SavedConfigurations = {};

function generateId() { return 'id_' + Date.now() + '_' + Math.random().toString(36).substr(2, 9); }
function formatCurrency(num) { return '$' + parseFloat(num || 0).toFixed(2).replace(/\d(?=(\d{3})+\.)/g, '$&,'); }
function calculateSellPrice(cost, markup) { return (parseFloat(cost) || 0) * (1 + (parseFloat(markup) || 0) / 100); }
function getVal(id) { const el = document.getElementById(id); return el ? el.value : ''; }
function setVal(id, val) { const el = document.getElementById(id); if (el) el.value = val ?? ''; }

function getDoorTypeLabel(type) { const labels = { 'HM-3HR': 'HM 3-Hour Fire', 'HM-90': 'HM 90-Min Fire', 'HM-45': 'HM 45-Min Fire', 'HM-20': 'HM 20-Min Fire', 'HM-STD': 'HM Non-Rated', 'RF': 'RF Shielded', 'STC': 'STC Acoustic', 'WD-PAINT': 'Wood Paint', 'WD-STAIN': 'Wood Stain', 'WD-LAM': 'Wood Laminate' }; return labels[type] || type; }
function getFrameTypeLabel(type) { const labels = { 'KD-DW-16': 'KD Drywall 16ga', 'KD-DW-14': 'KD Drywall 14ga', 'KD-MASONRY': 'KD Masonry', 'KD-EXIST': 'KD Existing', 'WLD-DW': 'Welded Drywall', 'WLD-MASONRY': 'Welded Masonry', 'WLD-CONCRETE': 'Welded Concrete', 'SINGLE': 'Single Frame', 'PAIR': 'Pair Frame', 'SL-1': 'Single+1 Sidelite', 'DBL-EGRESS': 'Double Egress' }; return labels[type] || type; }

function createNewDoor() {
    return { 
        id: generateId(), 
        quantity: 1,
        door: { type: '', typeManual: '', brand: '', brandManual: '', model: '', modelManual: '', width: '', height: '', thickness: '1-3/4', fireRating: 'None', handing: 'LH', swing: 'Inswing', cost: 0, markup: 30, labor: 0 },
        frame: { type: '', typeManual: '', brand: '', brandManual: '', model: '', modelManual: '', material: 'HM-16', anchors: 'Steel-Stud', jambDepth: '4-3/4', prep: 'STD', cost: 0, markup: 30, labor: 0 },
        hardware: [], 
        notes: '',
        // Data Spec Sheets stored with each door
        specs: {
            door: { image: '', notes: '' },
            frame: { image: '', notes: '' },
            hardware: [] // Array of { type, image, notes }
        }
    };
}

function addNewDoor() { AppState.doors.push(createNewDoor()); AppState.activeIndex = AppState.doors.length - 1; renderTabs(); loadDoorToForm(); }
function removeDoor(index) { if (AppState.doors.length === 1) return; AppState.doors.splice(index, 1); AppState.activeIndex = Math.min(AppState.activeIndex, AppState.doors.length - 1); renderTabs(); loadDoorToForm(); }
function switchToDoor(index) { AppState.activeIndex = index; renderTabs(); loadDoorToForm(); }

function renderTabs() {
    const container = document.getElementById('doorTabs');
    container.innerHTML = '';
    const customerName = AppState.job.customerName || 'Customer';
    const jobRef = AppState.job.jobReference || '';
    AppState.doors.forEach((door, idx) => {
        const tab = document.createElement('div'); tab.className = 'tab';
        const btn = document.createElement('button'); btn.className = 'tab-btn' + (idx === AppState.activeIndex ? ' active' : '');
        const label = jobRef ? `${customerName} - ${jobRef}` : customerName;
        btn.textContent = label; btn.onclick = () => switchToDoor(idx);
        tab.appendChild(btn);
        if (AppState.doors.length > 1) { const delBtn = document.createElement('button'); delBtn.className = 'btn btn-danger'; delBtn.textContent = '‚úï'; delBtn.onclick = (e) => { e.stopPropagation(); removeDoor(idx); }; tab.appendChild(delBtn); }
        container.appendChild(tab);
    });
}

function populateBrandDropdown(selectId, category) { const select = document.getElementById(selectId); select.innerHTML = '<option value="">-- Select --</option>'; Object.keys(BrandLibrary[category] || {}).forEach(b => { const opt = document.createElement('option'); opt.value = b; opt.textContent = b; select.appendChild(opt); }); }
function populateModelDropdown(selectId, category, brand) { const select = document.getElementById(selectId); select.innerHTML = '<option value="">-- Select --</option>'; (BrandLibrary[category]?.[brand] || []).forEach(m => { const opt = document.createElement('option'); opt.value = m; opt.textContent = m; select.appendChild(opt); }); }

function loadDoorToForm() {
    const door = AppState.doors[AppState.activeIndex]; if (!door) return;
    
    // Ensure specs object exists
    if (!door.specs) door.specs = { door: { image: '', notes: '' }, frame: { image: '', notes: '' }, hardware: [] };
    
    setVal('estimateNumber', AppState.job.estimateNumber); setVal('estimateDate', AppState.job.estimateDate); setVal('customerName', AppState.job.customerName); setVal('jobReference', AppState.job.jobReference); setVal('jobAddress', AppState.job.jobAddress || ''); setVal('deliveryAddress', AppState.job.deliveryAddress || '');
    setVal('doorQuantity', door.quantity); setVal('doorType', door.door.type); setVal('doorTypeManual', door.door.typeManual || '');
    setVal('doorWidth', door.door.width); setVal('doorHeight', door.door.height); setVal('doorThickness', door.door.thickness);
    setVal('doorFireRating', door.door.fireRating); setVal('doorHanding', door.door.handing); setVal('doorSwing', door.door.swing);
    setVal('doorCost', door.door.cost || ''); setVal('doorMarkup', door.door.markup); setVal('doorLabor', door.door.labor || '');
    populateBrandDropdown('doorBrand', 'doors'); setVal('doorBrand', door.door.brand); setVal('doorBrandManual', door.door.brandManual || '');
    populateModelDropdown('doorModel', 'doors', door.door.brand); setVal('doorModel', door.door.model); setVal('doorModelManual', door.door.modelManual || '');
    toggleManualEntry('doorType', 'doorTypeManual', door.door.type === 'OTHER'); toggleManualEntry('doorBrand', 'doorBrandManual', door.door.brand === 'Other'); toggleManualEntry('doorModel', 'doorModelManual', door.door.model === 'Manual Entry');
    setVal('frameType', door.frame.type); setVal('frameTypeManual', door.frame.typeManual || ''); setVal('frameMaterial', door.frame.material || 'HM-16');
    setVal('frameAnchors', door.frame.anchors); setVal('frameJambDepth', door.frame.jambDepth || '4-3/4'); setVal('framePrep', door.frame.prep || 'STD');
    setVal('frameCost', door.frame.cost || ''); setVal('frameMarkup', door.frame.markup); setVal('frameLabor', door.frame.labor || '');
    populateBrandDropdown('frameBrand', 'frames'); setVal('frameBrand', door.frame.brand); setVal('frameBrandManual', door.frame.brandManual || '');
    populateModelDropdown('frameModel', 'frames', door.frame.brand); setVal('frameModel', door.frame.model); setVal('frameModelManual', door.frame.modelManual || '');
    toggleManualEntry('frameType', 'frameTypeManual', door.frame.type === 'OTHER'); toggleManualEntry('frameBrand', 'frameBrandManual', door.frame.brand === 'Other'); toggleManualEntry('frameModel', 'frameModelManual', door.frame.model === 'Manual Entry');
    renderHardwareList(); 
    setVal('doorNotes', door.notes); 
    updatePriceDisplays(); 
    updateSummary();
    
    // Load Data Specs
    loadDataSpecs();
}

function toggleManualEntry(selectId, inputId, show) { const input = document.getElementById(inputId); if (input) input.style.display = show ? 'block' : 'none'; }

function updateJobInfo() { AppState.job.estimateNumber = getVal('estimateNumber'); AppState.job.estimateDate = getVal('estimateDate'); AppState.job.customerName = getVal('customerName'); AppState.job.jobReference = getVal('jobReference'); AppState.job.jobAddress = getVal('jobAddress'); AppState.job.deliveryAddress = getVal('deliveryAddress'); renderTabs(); updateSummary(); }

function copyJobSiteToDelivery() {
    const checkbox = document.getElementById('sameAsJobSite');
    const deliveryInput = document.getElementById('deliveryAddress');
    const jobAddress = getVal('jobAddress');
    if (checkbox.checked && jobAddress) {
        deliveryInput.value = jobAddress;
        AppState.job.deliveryAddress = jobAddress;
    }
}

function updateDoor() {
    const door = AppState.doors[AppState.activeIndex]; if (!door) return;
    door.quantity = parseInt(getVal('doorQuantity')) || 1;
    // Sync quantity to specs section
    const qtyDisplay = document.getElementById('specQtyDisplay');
    const qtyInput = document.getElementById('specQtyInput');
    if (qtyDisplay) qtyDisplay.textContent = door.quantity;
    if (qtyInput) qtyInput.value = door.quantity;
    
    door.door.type = getVal('doorType'); door.door.typeManual = getVal('doorTypeManual'); door.door.brand = getVal('doorBrand'); door.door.brandManual = getVal('doorBrandManual'); door.door.model = getVal('doorModel'); door.door.modelManual = getVal('doorModelManual');
    door.door.width = getVal('doorWidth'); door.door.height = getVal('doorHeight'); door.door.thickness = getVal('doorThickness'); door.door.fireRating = getVal('doorFireRating'); door.door.handing = getVal('doorHanding'); door.door.swing = getVal('doorSwing');
    door.door.cost = parseFloat(getVal('doorCost')) || 0; door.door.markup = parseFloat(getVal('doorMarkup')) || 0; door.door.labor = parseFloat(getVal('doorLabor')) || 0;
    door.frame.type = getVal('frameType'); door.frame.typeManual = getVal('frameTypeManual'); door.frame.brand = getVal('frameBrand'); door.frame.brandManual = getVal('frameBrandManual'); door.frame.model = getVal('frameModel'); door.frame.modelManual = getVal('frameModelManual');
    door.frame.material = getVal('frameMaterial'); door.frame.anchors = getVal('frameAnchors'); door.frame.jambDepth = getVal('frameJambDepth'); door.frame.prep = getVal('framePrep');
    door.frame.cost = parseFloat(getVal('frameCost')) || 0; door.frame.markup = parseFloat(getVal('frameMarkup')) || 0; door.frame.labor = parseFloat(getVal('frameLabor')) || 0;
    door.notes = getVal('doorNotes'); updatePriceDisplays(); updateSummary(); renderTabs();
    
    // Refresh spec displays
    refreshSpecInfo();
}

function updateQuantity() {
    const door = AppState.doors[AppState.activeIndex];
    if (!door) return;
    door.quantity = parseInt(getVal('doorQuantity')) || 1;
    // Sync quantity to specs section
    const qtyDisplay = document.getElementById('specQtyDisplay');
    const qtyInput = document.getElementById('specQtyInput');
    if (qtyDisplay) qtyDisplay.textContent = door.quantity;
    if (qtyInput) qtyInput.value = door.quantity;
    // Clear specs so they regenerate with new quantity
    door.specs.door.notes = '';
    door.specs.frame.notes = '';
    if (door.specs.hardware) {
        door.specs.hardware.forEach(s => s.notes = '');
    }
    loadDataSpecs();
    updateSummary();
    renderTabs();
}

function refreshSpecInfo() {
    const door = AppState.doors[AppState.activeIndex];
    if (!door) return;
    
    // Always update door spec info with current data
    const doorInfo = generateDoorSpecInfo(door);
    const doorNotesEl = document.getElementById('doorSpecNotes');
    if (doorNotesEl) {
        doorNotesEl.value = doorInfo;
        door.specs.door.notes = doorInfo;
    }
    
    // Always update frame spec info with current data
    const frameInfo = generateFrameSpecInfo(door);
    const frameNotesEl = document.getElementById('frameSpecNotes');
    if (frameNotesEl) {
        frameNotesEl.value = frameInfo;
        door.specs.frame.notes = frameInfo;
    }
    
    // Also refresh hardware specs
    renderHardwareSpecs();
}

// Force regenerate all specs with current order data
function regenerateAllSpecs() {
    const door = AppState.doors[AppState.activeIndex];
    if (!door) return;
    door.specs.door.notes = '';
    door.specs.door.lastGenerated = '';
    door.specs.frame.notes = '';
    door.specs.frame.lastGenerated = '';
    if (door.specs.hardware) {
        door.specs.hardware.forEach(s => { s.notes = ''; });
    }
    loadDataSpecs();
}

function updateDoorType() { 
    const type = getVal('doorType'); 
    const door = AppState.doors[AppState.activeIndex]; 
    if (door) {
        door.door.type = type;
        // Clear door specs so they regenerate with new info
        door.specs.door.notes = '';
    }
    toggleManualEntry('doorType', 'doorTypeManual', type === 'OTHER'); 
    updateDoor();
    loadDataSpecs();
}
function updateDoorBrand() { 
    const brand = getVal('doorBrand'); 
    const door = AppState.doors[AppState.activeIndex]; 
    toggleManualEntry('doorBrand', 'doorBrandManual', brand === 'Other'); 
    populateModelDropdown('doorModel', 'doors', brand); 
    if (door) { 
        door.door.brand = brand; 
        door.door.model = ''; 
        door.specs.door.notes = ''; // Clear to regenerate
    } 
    updateDoor();
    loadDataSpecs();
}
function updateDoorModel() { 
    const door = AppState.doors[AppState.activeIndex];
    if (door) door.specs.door.notes = ''; // Clear to regenerate
    toggleManualEntry('doorModel', 'doorModelManual', getVal('doorModel') === 'Manual Entry'); 
    updateDoor();
    loadDataSpecs();
}
function updateFrameType() { 
    const type = getVal('frameType'); 
    const door = AppState.doors[AppState.activeIndex]; 
    if (door) {
        door.frame.type = type;
        // Clear frame specs so they regenerate with new info
        door.specs.frame.notes = '';
    }
    toggleManualEntry('frameType', 'frameTypeManual', type === 'OTHER'); 
    updateDoor();
    loadDataSpecs();
}
function updateFrameBrand() { 
    const brand = getVal('frameBrand'); 
    const door = AppState.doors[AppState.activeIndex]; 
    toggleManualEntry('frameBrand', 'frameBrandManual', brand === 'Other'); 
    populateModelDropdown('frameModel', 'frames', brand); 
    if (door) { 
        door.frame.brand = brand; 
        door.frame.model = ''; 
        door.specs.frame.notes = ''; // Clear to regenerate
    } 
    updateDoor();
    loadDataSpecs();
}
function updateFrameModel() { 
    const door = AppState.doors[AppState.activeIndex];
    if (door) door.specs.frame.notes = ''; // Clear to regenerate
    toggleManualEntry('frameModel', 'frameModelManual', getVal('frameModel') === 'Manual Entry'); 
    updateDoor();
    loadDataSpecs();
}
function updatePriceDisplays() { const door = AppState.doors[AppState.activeIndex]; if (!door) return; setVal('doorSellPrice', formatCurrency(calculateSellPrice(door.door.cost, door.door.markup))); setVal('frameSellPrice', formatCurrency(calculateSellPrice(door.frame.cost, door.frame.markup))); }

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// DATA SPECS FUNCTIONS
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê

function loadDataSpecs() {
    const door = AppState.doors[AppState.activeIndex];
    if (!door || !door.specs) return;
    
    // Update quantity display in specs section
    const qtyDisplay = document.getElementById('specQtyDisplay');
    const qtyInput = document.getElementById('specQtyInput');
    if (qtyDisplay) qtyDisplay.textContent = door.quantity;
    if (qtyInput) qtyInput.value = door.quantity;
    
    // Generate Door spec info from actual selections - always show current data
    const doorInfo = generateDoorSpecInfo(door);
    const doorImgArea = document.getElementById('doorSpecImage');
    if (doorImgArea) {
        if (door.specs.door.image) {
            doorImgArea.innerHTML = `<img src="${door.specs.door.image}">`;
            doorImgArea.classList.remove('empty');
            doorImgArea.onclick = () => { if(confirm('Remove image?')) { door.specs.door.image = ''; loadDataSpecs(); } };
        } else {
            doorImgArea.innerHTML = 'Click to upload image';
            doorImgArea.classList.add('empty');
            doorImgArea.onclick = () => document.getElementById('doorSpecImageInput').click();
        }
    }
    const doorNotesEl = document.getElementById('doorSpecNotes');
    if (doorNotesEl) {
        door.specs.door.notes = doorInfo;
        doorNotesEl.value = doorInfo;
    }
    
    // Generate Frame spec info from actual selections - always show current data
    const frameInfo = generateFrameSpecInfo(door);
    const frameImgArea = document.getElementById('frameSpecImage');
    if (frameImgArea) {
        if (door.specs.frame.image) {
            frameImgArea.innerHTML = `<img src="${door.specs.frame.image}">`;
            frameImgArea.classList.remove('empty');
            frameImgArea.onclick = () => { if(confirm('Remove image?')) { door.specs.frame.image = ''; loadDataSpecs(); } };
        } else {
            frameImgArea.innerHTML = 'Click to upload image';
            frameImgArea.classList.add('empty');
            frameImgArea.onclick = () => document.getElementById('frameSpecImageInput').click();
        }
    }
    const frameNotesEl = document.getElementById('frameSpecNotes');
    if (frameNotesEl) {
        door.specs.frame.notes = frameInfo;
        frameNotesEl.value = frameInfo;
    }
    
    // Hardware specs
    renderHardwareSpecs();
}

function generateDoorSpecInfo(door) {
    let info = [];
    // Always show quantity first
    info.push(`QTY: ${door.quantity}`);
    // Door type
    info.push(`DOOR TYPE: ${door.door.type ? (door.door.type === 'OTHER' ? door.door.typeManual : getDoorTypeLabel(door.door.type)) : '‚Äî'}`);
    // Door dimensions - clearly labeled as DOOR
    info.push(`DOOR WIDTH: ${door.door.width ? door.door.width + '"' : '‚Äî'}`);
    info.push(`DOOR HEIGHT: ${door.door.height ? door.door.height + '"' : '‚Äî'}`);
    info.push(`DOOR THICKNESS: ${door.door.thickness ? door.door.thickness + '"' : '‚Äî'}`);
    // Brand/Model
    const brand = door.door.brand === 'Other' ? door.door.brandManual : door.door.brand;
    const model = door.door.model === 'Manual Entry' ? door.door.modelManual : door.door.model;
    info.push(`DOOR BRAND: ${brand || '‚Äî'}`);
    info.push(`DOOR MODEL: ${model || '‚Äî'}`);
    // Fire rating
    info.push(`FIRE RATING: ${door.door.fireRating && door.door.fireRating !== 'None' ? door.door.fireRating : '‚Äî'}`);
    // Handing and swing
    info.push(`HANDING: ${door.door.handing || '‚Äî'}`);
    info.push(`SWING: ${door.door.swing || '‚Äî'}`);
    
    return info.join('\n');
}

function generateFrameSpecInfo(door) {
    let info = [];
    // Always show quantity first
    info.push(`QTY: ${door.quantity}`);
    // Frame type
    info.push(`FRAME TYPE: ${door.frame.type ? (door.frame.type === 'OTHER' ? door.frame.typeManual : getFrameTypeLabel(door.frame.type)) : '‚Äî'}`);
    // Frame material
    const matLabels = { 'HM-16': '16 Ga. Hollow Metal', 'HM-14': '14 Ga. Hollow Metal', 'HM-12': '12 Ga. Hollow Metal', 'WD': 'Wood', 'AL': 'Aluminum', 'SS': 'Stainless Steel' };
    info.push(`FRAME MATERIAL: ${door.frame.material ? (matLabels[door.frame.material] || door.frame.material) : '‚Äî'}`);
    // Brand/Model
    const brand = door.frame.brand === 'Other' ? door.frame.brandManual : door.frame.brand;
    const model = door.frame.model === 'Manual Entry' ? door.frame.modelManual : door.frame.model;
    info.push(`FRAME BRAND: ${brand || '‚Äî'}`);
    info.push(`FRAME MODEL: ${model || '‚Äî'}`);
    // Jamb depth
    info.push(`JAMB DEPTH: ${door.frame.jambDepth ? door.frame.jambDepth + '"' : '‚Äî'}`);
    // Anchors
    const anchorLabels = { 'Steel-Stud': 'Steel Stud Anchor', 'Wood-Stud': 'Wood Stud Anchor', 'Masonry': 'Masonry Anchor', 'Masonry-T': 'Masonry T-Anchor', 'Compression': 'Compression Anchor', 'Existing': 'Existing Opening' };
    info.push(`ANCHORS: ${door.frame.anchors ? (anchorLabels[door.frame.anchors] || door.frame.anchors) : '‚Äî'}`);
    // Prep
    const prepLabels = { 'STD': 'Standard (161)', 'MORTISE': 'Mortise Lock', 'DEADBOLT': 'Deadbolt', 'EXIT': 'Exit Device', 'ELECTRIC': 'Electric Strike', 'ELEC': 'Electric Strike', 'NONE': 'No Prep' };
    info.push(`HEAD/STRIKE PREP: ${door.frame.prep ? (prepLabels[door.frame.prep] || door.frame.prep) : '‚Äî'}`);
    
    return info.join('\n');
}

function generateHardwareSpecInfo(hw) {
    if (!hw) return '';
    
    let info = [];
    // Always show quantity first
    info.push(`QTY: ${hw.qty || 1}`);
    info.push(`ITEM: ${hw.label || hw.type || '‚Äî'}`);
    // Brand/Model
    const brand = hw.brand === 'Other' ? hw.brandManual : hw.brand;
    const model = hw.model === 'Manual Entry' ? hw.modelManual : hw.model;
    info.push(`BRAND: ${brand || '‚Äî'}`);
    info.push(`MODEL: ${model || '‚Äî'}`);
    
    return info.join('\n');
}

function updateQtyFromSpecs(qty) {
    const door = AppState.doors[AppState.activeIndex];
    if (!door) return;
    door.quantity = parseInt(qty) || 1;
    setVal('doorQuantity', door.quantity);
    document.getElementById('specQtyDisplay').textContent = door.quantity;
    // Clear specs so they regenerate with new quantity
    door.specs.door.notes = '';
    door.specs.frame.notes = '';
    if (door.specs.hardware) {
        door.specs.hardware.forEach(s => s.notes = '');
    }
    loadDataSpecs();
    updateSummary();
    renderTabs();
}

function renderHardwareSpecs() {
    const door = AppState.doors[AppState.activeIndex];
    const container = document.getElementById('hardwareSpecsContainer');
    if (!container) return;
    if (!door || !door.hardware || door.hardware.length === 0) {
        container.innerHTML = '<p style="color:#9ca3af; text-align:center; padding:15px; font-size:12px;">No hardware added. Click "+ Add Hardware" above to add hardware items.</p>';
        return;
    }
    
    // Ensure specs.hardware array matches hardware array
    if (!door.specs.hardware) door.specs.hardware = [];
    while (door.specs.hardware.length < door.hardware.length) {
        door.specs.hardware.push({ image: '', notes: '' });
    }
    
    container.innerHTML = door.hardware.map((hw, idx) => {
        const spec = door.specs.hardware[idx] || { image: '', notes: '' };
        const hasImage = spec.image ? true : false;
        
        // Always generate hardware info from current data
        const hwInfo = generateHardwareSpecInfo(hw);
        spec.notes = hwInfo;
        door.specs.hardware[idx].notes = hwInfo;
        
        return `
        <div class="spec-item">
            <div class="spec-item-header">
                <span class="spec-item-title">${hw.label || hw.type}</span>
            </div>
            <div class="spec-item-content">
                <div class="spec-image-area ${hasImage ? '' : 'empty'}" id="hwSpecImage-${idx}" onclick="handleHwSpecImageClick(${idx}, ${hasImage})">
                    ${hasImage ? `<img src="${spec.image}">` : 'Click to upload image'}
                </div>
                <input type="file" id="hwSpecImageInput-${idx}" accept="image/*" style="display:none" onchange="handleHwSpecImageUpload(${idx}, event)">
                <div class="spec-notes">
                    <textarea id="hwSpecNotes-${idx}" placeholder="Hardware specifications..." onchange="updateHwSpecNotes(${idx})">${hwInfo}</textarea>
                </div>
            </div>
        </div>`;
    }).join('');
}

function handleHwSpecImageClick(idx, hasImage) {
    if (hasImage) {
        removeHwSpecImage(idx);
    } else {
        document.getElementById('hwSpecImageInput-' + idx).click();
    }
}

function handleSpecImageUpload(type, event) {
    const file = event.target.files[0];
    if (!file) return;
    const door = AppState.doors[AppState.activeIndex];
    if (!door) return;
    
    const reader = new FileReader();
    reader.onload = function(e) {
        door.specs[type].image = e.target.result;
        loadDataSpecs();
    };
    reader.readAsDataURL(file);
    event.target.value = '';
}

function updateSpecNotes(type) {
    const door = AppState.doors[AppState.activeIndex];
    if (!door) return;
    door.specs[type].notes = getVal(type + 'SpecNotes');
}

function handleHwSpecImageUpload(idx, event) {
    const file = event.target.files[0];
    if (!file) return;
    const door = AppState.doors[AppState.activeIndex];
    if (!door) return;
    
    const reader = new FileReader();
    reader.onload = function(e) {
        if (!door.specs.hardware[idx]) door.specs.hardware[idx] = { image: '', notes: '' };
        door.specs.hardware[idx].image = e.target.result;
        renderHardwareSpecs();
    };
    reader.readAsDataURL(file);
    event.target.value = '';
}

function removeHwSpecImage(idx) {
    if (!confirm('Remove image?')) return;
    const door = AppState.doors[AppState.activeIndex];
    if (door && door.specs.hardware[idx]) {
        door.specs.hardware[idx].image = '';
        renderHardwareSpecs();
    }
}

function updateHwSpecNotes(idx) {
    const door = AppState.doors[AppState.activeIndex];
    if (!door) return;
    if (!door.specs.hardware[idx]) door.specs.hardware[idx] = { image: '', notes: '' };
    door.specs.hardware[idx].notes = getVal('hwSpecNotes-' + idx);
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// HARDWARE MANAGEMENT
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê

function renderHardwareList() {
    const door = AppState.doors[AppState.activeIndex]; const container = document.getElementById('hardwareList');
    if (!door.hardware || door.hardware.length === 0) { container.innerHTML = '<div style="padding:20px;text-align:center;color:#9ca3af;">No hardware. Click "+ Add Hardware"</div>'; return; }
    container.innerHTML = door.hardware.map((hw, idx) => `
        <div class="hardware-item">
            <div class="hardware-item-header"><span class="hardware-item-title">${hw.label || 'Hardware'}</span><button class="btn btn-danger btn-sm" onclick="removeHardwareItem(${idx})">Remove</button></div>
            <div class="form-row">
                <div class="form-group"><label>Type</label><select onchange="updateHardwareType(${idx}, this.value)">${HardwareCatalog.map(h => `<option value="${h.id}" ${hw.type === h.id ? 'selected' : ''}>${h.label}</option>`).join('')}</select></div>
                <div class="form-group"><label>Brand</label><select id="hwBrand-${idx}" onchange="updateHardwareBrand(${idx}, this.value)"><option value="">-- Select --</option>${Object.keys(BrandLibrary.hardware).map(b => `<option value="${b}" ${hw.brand === b ? 'selected' : ''}>${b}</option>`).join('')}</select><input type="text" id="hwBrandManual-${idx}" placeholder="Brand..." style="display:${hw.brand === 'Other' ? 'block' : 'none'}; margin-top:6px;" value="${hw.brandManual || ''}" onchange="updateHardwareBrandManual(${idx}, this.value)"></div>
                <div class="form-group"><label>Model</label><select id="hwModel-${idx}" onchange="updateHardwareModel(${idx}, this.value)"><option value="">-- Select --</option>${(BrandLibrary.hardware[hw.brand] || []).map(m => `<option value="${m}" ${hw.model === m ? 'selected' : ''}>${m}</option>`).join('')}</select><input type="text" id="hwModelManual-${idx}" placeholder="Model..." style="display:${hw.model === 'Manual Entry' ? 'block' : 'none'}; margin-top:6px;" value="${hw.modelManual || ''}" onchange="updateHardwareModelManual(${idx}, this.value)"></div>
                <div class="form-group"><label>Qty</label><input type="number" value="${hw.qty || 1}" min="1" onchange="updateHardwareQty(${idx}, this.value)"></div>
            </div>
            <div class="pricing-row">
                <div class="form-group"><label>Cost</label><input type="number" class="cost-input" value="${hw.cost || ''}" step="0.01" onchange="updateHardwareCost(${idx}, this.value)"></div>
                <div class="form-group"><label>Markup %</label><input type="number" class="markup-input" value="${hw.markup || 30}" onchange="updateHardwareMarkup(${idx}, this.value)"></div>
                <div class="form-group"><label>Sell</label><input type="text" class="sell-price" value="${formatCurrency(calculateSellPrice(hw.cost, hw.markup))}" readonly></div>
                <div class="form-group"><label>Labor</label><input type="number" class="labor-input" value="${hw.labor || ''}" step="0.01" onchange="updateHardwareLabor(${idx}, this.value)"></div>
            </div>
        </div>`).join('');
    
    // Also update hardware specs
    renderHardwareSpecs();
}

function addHardwareItem() { 
    const door = AppState.doors[AppState.activeIndex]; 
    const def = HardwareCatalog[0]; 
    door.hardware.push({ type: def.id, label: def.label, brand: def.defaultBrand, brandManual: '', model: def.defaultModel, modelManual: '', qty: 1, cost: 0, markup: 30, labor: 0 }); 
    // Add corresponding spec entry (blank - user fills in)
    if (!door.specs.hardware) door.specs.hardware = [];
    door.specs.hardware.push({ image: '', notes: '' });
    renderHardwareList(); 
    updateSummary(); 
}

function removeHardwareItem(idx) { 
    const door = AppState.doors[AppState.activeIndex];
    door.hardware.splice(idx, 1); 
    // Also remove spec
    if (door.specs.hardware && door.specs.hardware[idx]) {
        door.specs.hardware.splice(idx, 1);
    }
    renderHardwareList(); 
    updateSummary(); 
}

function updateHardwareType(idx, typeId) { 
    const door = AppState.doors[AppState.activeIndex]; 
    const item = HardwareCatalog.find(h => h.id === typeId); 
    door.hardware[idx].type = typeId; 
    door.hardware[idx].label = item?.label || typeId; 
    door.hardware[idx].brand = item?.defaultBrand || ''; 
    door.hardware[idx].model = item?.defaultModel || ''; 
    if (!door.specs.hardware[idx]) door.specs.hardware[idx] = { image: '', notes: '' };
    // Clear notes so they regenerate with new info
    door.specs.hardware[idx].notes = '';
    renderHardwareList(); 
    renderHardwareSpecs();
    updateSummary(); 
}
function updateHardwareBrand(idx, brand) { 
    const door = AppState.doors[AppState.activeIndex]; 
    door.hardware[idx].brand = brand; 
    door.hardware[idx].model = ''; 
    if (door.specs.hardware[idx]) door.specs.hardware[idx].notes = '';
    renderHardwareList(); 
    renderHardwareSpecs();
    updateSummary(); 
}
function updateHardwareBrandManual(idx, val) { 
    const door = AppState.doors[AppState.activeIndex];
    door.hardware[idx].brandManual = val; 
    if (door.specs.hardware[idx]) door.specs.hardware[idx].notes = '';
    renderHardwareSpecs();
    updateSummary(); 
}
function updateHardwareModel(idx, model) { 
    const door = AppState.doors[AppState.activeIndex];
    door.hardware[idx].model = model; 
    const mi = document.getElementById(`hwModelManual-${idx}`); 
    if (mi) mi.style.display = model === 'Manual Entry' ? 'block' : 'none'; 
    if (!door.specs.hardware[idx]) door.specs.hardware[idx] = { image: '', notes: '' };
    // Clear notes so they regenerate with new info
    door.specs.hardware[idx].notes = '';
    renderHardwareSpecs();
    updateSummary(); 
}
function updateHardwareModelManual(idx, val) { 
    const door = AppState.doors[AppState.activeIndex];
    door.hardware[idx].modelManual = val; 
    if (door.specs.hardware[idx]) door.specs.hardware[idx].notes = '';
    renderHardwareSpecs();
    updateSummary(); 
}
function updateHardwareQty(idx, qty) { 
    const door = AppState.doors[AppState.activeIndex];
    door.hardware[idx].qty = parseInt(qty) || 1; 
    if (door.specs.hardware[idx]) door.specs.hardware[idx].notes = '';
    renderHardwareSpecs();
    updateSummary(); 
}
function updateHardwareCost(idx, cost) { AppState.doors[AppState.activeIndex].hardware[idx].cost = parseFloat(cost) || 0; renderHardwareList(); updateSummary(); }
function updateHardwareMarkup(idx, markup) { AppState.doors[AppState.activeIndex].hardware[idx].markup = parseFloat(markup) || 0; renderHardwareList(); updateSummary(); }
function updateHardwareLabor(idx, labor) { AppState.doors[AppState.activeIndex].hardware[idx].labor = parseFloat(labor) || 0; updateSummary(); }

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// SUMMARY
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê

function updateSummary() {
    const door = AppState.doors[AppState.activeIndex]; const container = document.getElementById('summaryContent');
    const customerName = AppState.job.customerName || 'Customer';
    const jobRef = AppState.job.jobReference || '';
    document.getElementById('summaryDoorLabel').textContent = customerName;
    document.getElementById('summaryJobRef').textContent = jobRef;
    document.getElementById('qtyMultiplier').textContent = door.quantity;
    const items = []; let materialsTotal = 0, laborTotal = 0;
    if (door.door.type || door.door.width) { const doorSell = calculateSellPrice(door.door.cost, door.door.markup); materialsTotal += doorSell; laborTotal += door.door.labor;
        const typeDisp = door.door.type === 'OTHER' ? door.door.typeManual : getDoorTypeLabel(door.door.type); const brandDisp = door.door.brand === 'Other' ? door.door.brandManual : door.door.brand;
        items.push({ category: 'DOOR', name: `${typeDisp || 'Door'}${brandDisp ? ' ‚Äì ' + brandDisp : ''}`, details: `${door.door.width || '?'}" √ó ${door.door.height || '?'}" | ${door.door.fireRating}`, price: doorSell, labor: door.door.labor }); }
    if (door.frame.type) { const frameSell = calculateSellPrice(door.frame.cost, door.frame.markup); materialsTotal += frameSell; laborTotal += door.frame.labor;
        const typeDisp = door.frame.type === 'OTHER' ? door.frame.typeManual : getFrameTypeLabel(door.frame.type); const brandDisp = door.frame.brand === 'Other' ? door.frame.brandManual : door.frame.brand;
        items.push({ category: 'FRAME', name: `${typeDisp || 'Frame'}${brandDisp ? ' ‚Äì ' + brandDisp : ''}`, details: `${door.frame.material} | ${door.frame.anchors}`, price: frameSell, labor: door.frame.labor }); }
    door.hardware.forEach(hw => { const hwSell = calculateSellPrice(hw.cost, hw.markup) * (hw.qty || 1); const hwLabor = (hw.labor || 0) * (hw.qty || 1); materialsTotal += hwSell; laborTotal += hwLabor;
        const brandDisp = hw.brand === 'Other' ? hw.brandManual : hw.brand;
        items.push({ category: 'HARDWARE', name: `${hw.label || hw.type}${brandDisp ? ' ‚Äì ' + brandDisp : ''}`, details: hw.qty > 1 ? `Qty: ${hw.qty}` : '', price: hwSell, labor: hwLabor }); });
    container.innerHTML = items.map(i => `<div class="summary-item"><div class="summary-category">${i.category}</div><div class="summary-item-name">${i.name}</div>${i.details ? `<div class="summary-details">${i.details}</div>` : ''}${i.price > 0 ? `<div class="summary-price">Mat: ${formatCurrency(i.price)}${i.labor > 0 ? ' | Lab: ' + formatCurrency(i.labor) : ''}</div>` : ''}</div>`).join('');
    const doorTotal = (materialsTotal + laborTotal) * door.quantity;
    document.getElementById('materialsSubtotal').textContent = formatCurrency(materialsTotal); document.getElementById('laborSubtotal').textContent = formatCurrency(laborTotal); document.getElementById('doorTotal').textContent = formatCurrency(doorTotal);
    let grandTotal = 0; AppState.doors.forEach(d => { let dMat = calculateSellPrice(d.door.cost, d.door.markup) + calculateSellPrice(d.frame.cost, d.frame.markup), dLab = (d.door.labor || 0) + (d.frame.labor || 0);
        d.hardware.forEach(hw => { dMat += calculateSellPrice(hw.cost, hw.markup) * (hw.qty || 1); dLab += (hw.labor || 0) * (hw.qty || 1); }); grandTotal += (dMat + dLab) * d.quantity; });
    document.getElementById('grandTotal').textContent = formatCurrency(grandTotal);
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// SPEC SHEET GENERATION (with images and notes)
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê

function generateCleanSpecSheetHTML() {
    const job = AppState.job;
    let grandTotal = 0, totalMaterials = 0, totalLabor = 0;
    
    // Collect specs data for second section
    let allSpecs = [];
    
    let html = `<!DOCTYPE html>
<html><head><meta charset="UTF-8"><title>Aloha Doors - ${job.estimateNumber || 'Spec Sheet'}</title>
<style>
* { margin: 0; padding: 0; box-sizing: border-box; }
body { 
    font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; 
    font-size: 11px; 
    padding: 0; 
    max-width: 850px; 
    margin: 0 auto; 
    background: white;
    color: #333;
}

/* Header - Compact */
.main-header {
    background: linear-gradient(135deg, #8B0000 0%, #c41e3a 100%);
    color: white;
    padding: 15px 25px;
    margin-bottom: 0;
}
.header-content {
    display: flex;
    justify-content: space-between;
    align-items: center;
}
.company-name {
    font-size: 26px;
    font-weight: 700;
    letter-spacing: 3px;
    text-shadow: 2px 2px 4px rgba(0,0,0,0.2);
}
.company-tagline {
    font-size: 9px;
    letter-spacing: 2px;
    opacity: 0.9;
    margin-top: 2px;
}
.doc-info {
    text-align: right;
    font-size: 10px;
    line-height: 1.4;
}
.doc-info strong {
    color: #ffd700;
}
.estimate-number {
    font-size: 14px;
    font-weight: 700;
    background: rgba(255,255,255,0.15);
    padding: 5px 12px;
    border-radius: 4px;
    margin-bottom: 5px;
    display: inline-block;
}

/* Customer Banner - Compact */
.customer-banner {
    background: #1a1a2e;
    color: white;
    padding: 8px 25px;
    display: flex;
    justify-content: space-between;
    align-items: center;
}
.customer-name {
    font-size: 13px;
    font-weight: 600;
}
.job-ref {
    font-size: 10px;
    opacity: 0.8;
}

/* Content Area - Compact */
.content {
    padding: 12px 20px;
}

/* Door Section - Compact */
.door-section {
    margin-bottom: 10px;
    border: 1px solid #ddd;
    border-radius: 6px;
    overflow: hidden;
    box-shadow: 0 1px 4px rgba(0,0,0,0.06);
}
.door-header {
    background: linear-gradient(135deg, #2c3e50, #3498db);
    color: white;
    padding: 6px 15px;
    display: flex;
    justify-content: space-between;
    align-items: center;
}
.door-title {
    font-size: 12px;
    font-weight: 700;
}
.door-qty {
    background: #ffd700;
    color: #1a1a2e;
    padding: 3px 12px;
    border-radius: 12px;
    font-weight: 700;
    font-size: 11px;
}
.door-content {
    padding: 0;
}

/* Table Styling - Compact */
table {
    width: 100%;
    border-collapse: collapse;
}
th {
    background: #f8f9fa;
    color: #333;
    padding: 5px 8px;
    text-align: left;
    font-size: 8px;
    text-transform: uppercase;
    letter-spacing: 0.5px;
    border-bottom: 2px solid #8B0000;
}
td {
    padding: 6px 8px;
    border-bottom: 1px solid #eee;
    font-size: 9px;
    vertical-align: middle;
}
tr:hover { background: #fafafa; }
.component-label {
    font-weight: 700;
    color: #8B0000;
    font-size: 8px;
    text-transform: uppercase;
    letter-spacing: 0.3px;
}
.type-value {
    font-weight: 600;
    color: #333;
}
.brand-value {
    color: #666;
    font-size: 9px;
}
.specs-value {
    font-size: 8px;
    color: #555;
    line-height: 1.3;
}
.price-cell {
    text-align: right;
    font-weight: 600;
    font-family: 'Courier New', monospace;
    font-size: 9px;
}
.subtotal-row {
    background: linear-gradient(135deg, #f0f0f0, #e8e8e8);
}
.subtotal-row td {
    font-weight: 700;
    border-bottom: none;
    padding: 8px;
    font-size: 9px;
}

/* Notes - Compact */
.notes-box {
    background: linear-gradient(135deg, #fff8e1, #ffecb3);
    border-left: 3px solid #ffc107;
    padding: 6px 10px;
    margin: 0;
    font-size: 9px;
}
.notes-box strong {
    color: #ff8f00;
}

/* Totals - Compact */
.totals-section {
    margin-top: 15px;
    border-radius: 6px;
    overflow: hidden;
    box-shadow: 0 1px 4px rgba(0,0,0,0.1);
}
.totals-header {
    background: linear-gradient(135deg, #1a1a2e, #16213e);
    color: white;
    padding: 8px 15px;
    font-size: 11px;
    font-weight: 700;
    letter-spacing: 1px;
}
.totals-table {
    width: 100%;
}
.totals-table td {
    padding: 8px 15px;
    font-size: 11px;
}
.totals-table tr:last-child {
    background: linear-gradient(135deg, #8B0000, #c41e3a);
    color: white;
}
.totals-table tr:last-child td {
    font-size: 14px;
    font-weight: 700;
    padding: 10px 15px;
}
.totals-label {
    font-weight: 600;
}
.totals-amount {
    text-align: right;
    font-family: 'Courier New', monospace;
    font-weight: 700;
}

/* Footer - Compact */
.footer {
    text-align: center;
    margin-top: 15px;
    padding: 10px;
    border-top: 2px solid #8B0000;
    color: #666;
    font-size: 9px;
}
.footer-logo {
    font-size: 11px;
    font-weight: 700;
    color: #8B0000;
    margin-bottom: 2px;
}

/* Page Break */
.page-break {
    page-break-before: always;
    margin-top: 0;
}

/* Specifications Section */
.specs-page-header {
    background: linear-gradient(135deg, #1565c0, #1976d2);
    color: white;
    padding: 20px 30px;
    margin-bottom: 0;
}
.specs-page-title {
    font-size: 24px;
    font-weight: 700;
    letter-spacing: 2px;
}
.specs-page-subtitle {
    font-size: 11px;
    opacity: 0.9;
    margin-top: 5px;
}

.spec-door-section {
    margin-bottom: 30px;
    border: 2px solid #1565c0;
    border-radius: 10px;
    overflow: hidden;
}
.spec-door-header {
    background: linear-gradient(135deg, #2c3e50, #3498db);
    color: white;
    padding: 15px 20px;
    display: flex;
    justify-content: space-between;
    align-items: center;
}
.spec-door-title {
    font-size: 18px;
    font-weight: 700;
}
.spec-door-qty {
    background: #ffd700;
    color: #1a1a2e;
    padding: 8px 20px;
    border-radius: 20px;
    font-weight: 700;
    font-size: 16px;
}

.category-header {
    background: #8B0000;
    color: white;
    padding: 8px 20px;
    font-weight: 700;
    font-size: 14px;
    letter-spacing: 1px;
}

.spec-card {
    background: #fafafa;
    padding: 15px 20px;
}
.spec-card-title {
    font-weight: 700;
    color: #333;
    font-size: 14px;
    margin-bottom: 12px;
    padding-bottom: 8px;
    border-bottom: 2px solid #8B0000;
}
.spec-grid {
    display: flex;
    gap: 20px;
    align-items: flex-start;
}
.spec-image {
    flex-shrink: 0;
}
.spec-image img {
    max-width: 320px;
    max-height: 280px;
    border: 3px solid #333;
    border-radius: 8px;
    box-shadow: 0 4px 12px rgba(0,0,0,0.2);
}
.spec-details {
    flex: 1;
    font-size: 11px;
    line-height: 1.7;
    white-space: pre-line;
    color: #333;
    background: white;
    padding: 12px;
    border-radius: 8px;
    border: 1px solid #e0e0e0;
}

/* Spec Page Header - Compact */
.spec-page-header {
    background: linear-gradient(135deg, #1565c0, #1976d2);
    color: white;
    padding: 12px 25px;
    display: flex;
    justify-content: space-between;
    align-items: center;
}
.spec-page-info {
    text-align: right;
    font-size: 11px;
}
.spec-page-badge {
    background: #ffd700;
    color: #1a1a2e;
    padding: 5px 15px;
    border-radius: 15px;
    font-weight: 700;
    font-size: 13px;
    display: inline-block;
    margin-bottom: 5px;
}

/* Compact customer banner for spec pages */
.spec-customer-banner {
    background: #1a1a2e;
    color: white;
    padding: 10px 25px;
    display: flex;
    justify-content: space-between;
    align-items: center;
    font-size: 12px;
}

/* Compact content area for spec pages */
.spec-content {
    padding: 15px 25px;
}

/* Compact footer for spec pages */
.spec-footer {
    text-align: center;
    padding: 10px;
    border-top: 2px solid #8B0000;
    color: #666;
    font-size: 9px;
}

@media print {
    body { padding: 0; }
    @page { margin: 0.3in; }
    .door-section { page-break-inside: avoid; }
    .spec-page { page-break-before: always; page-break-inside: avoid; }
    .page-break { page-break-before: always; }
}
</style></head><body>

<!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
<!-- PAGE 1: INVOICE / PRICING -->
<!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->

<div class="main-header">
    <div class="header-content">
        <div class="company-info">
            <div class="company-name">ALOHA DOORS</div>
            <div class="company-tagline">214 Main St. #119, El Segundo CA 90245 ‚Ä¢ (310) 414-0488 ‚Ä¢ alohadoors.com</div>
        </div>
        <div class="doc-info">
            <div class="estimate-number">${job.estimateNumber || 'ESTIMATE'}</div>
            <div><strong>Date:</strong> ${job.estimateDate || new Date().toLocaleDateString()}</div>
        </div>
    </div>
</div>

<div class="customer-banner">
    <div>
        <div class="customer-name">${job.customerName || 'Customer'}</div>
        ${job.jobAddress ? `<div class="job-ref">${job.jobAddress}</div>` : ''}
        ${job.jobReference ? `<div class="job-ref">Ref: ${job.jobReference}</div>` : ''}
    </div>
    <div style="font-size: 10px; text-align: right;">
        ${job.deliveryAddress ? `<div><strong>Deliver To:</strong> ${job.deliveryAddress}</div>` : ''}
        <div><strong>${AppState.doors.length}</strong> Door Config${AppState.doors.length > 1 ? 's' : ''}</div>
    </div>
</div>

<div class="content">`;

    // FIRST PASS: Output pricing tables only
    AppState.doors.forEach((door, idx) => {
        let doorMaterials = 0, doorLabor = 0;
        const doorSell = calculateSellPrice(door.door.cost, door.door.markup);
        const frameSell = calculateSellPrice(door.frame.cost, door.frame.markup);
        doorMaterials += doorSell + frameSell;
        doorLabor += (door.door.labor || 0) + (door.frame.labor || 0);
        
        const doorType = door.door.type === 'OTHER' ? door.door.typeManual : getDoorTypeLabel(door.door.type);
        const doorBrand = door.door.brand === 'Other' ? door.door.brandManual : door.door.brand;
        const doorModel = door.door.model === 'Manual Entry' ? door.door.modelManual : door.door.model;
        const frameType = door.frame.type === 'OTHER' ? door.frame.typeManual : getFrameTypeLabel(door.frame.type);
        const frameBrand = door.frame.brand === 'Other' ? door.frame.brandManual : door.frame.brand;
        const frameModel = door.frame.model === 'Manual Entry' ? door.frame.modelManual : door.frame.model;
        const customerName = job.customerName || '';
        const doorLabel = customerName ? `${customerName} - Door ${idx + 1}` : `Door #${idx + 1}`;
        
        html += `
<div class="door-section">
    <div class="door-header">
        <span class="door-title">${doorLabel}</span>
        <span class="door-qty">QTY: ${door.quantity}</span>
    </div>
    <div class="door-content">
        <table>
            <tr>
                <th style="width:12%">Component</th>
                <th style="width:18%">Type</th>
                <th style="width:20%">Brand / Model</th>
                <th style="width:30%">Specifications</th>
                <th style="width:10%">Material</th>
                <th style="width:10%">Labor</th>
            </tr>
            <tr>
                <td><span class="component-label">üö™ Door</span></td>
                <td class="type-value">${doorType || '‚Äî'}</td>
                <td class="brand-value">${doorBrand || '‚Äî'}${doorModel ? '<br/>' + doorModel : ''}</td>
                <td class="specs-value">${door.door.width || '‚Äî'}" W √ó ${door.door.height || '‚Äî'}" H √ó ${door.door.thickness}"<br/>Fire: ${door.door.fireRating || 'None'} | ${door.door.handing || 'LH'} | ${door.door.swing || 'Inswing'}</td>
                <td class="price-cell">${formatCurrency(doorSell)}</td>
                <td class="price-cell">${formatCurrency(door.door.labor)}</td>
            </tr>
            <tr>
                <td><span class="component-label">üî≤ Frame</span></td>
                <td class="type-value">${frameType || '‚Äî'}</td>
                <td class="brand-value">${frameBrand || '‚Äî'}${frameModel ? '<br/>' + frameModel : ''}</td>
                <td class="specs-value">${door.frame.material || 'HM-16'} | ${door.frame.anchors || 'Steel-Stud'}<br/>Jamb: ${door.frame.jambDepth || '4-3/4'}" | Prep: ${door.frame.prep || 'STD'}</td>
                <td class="price-cell">${formatCurrency(frameSell)}</td>
                <td class="price-cell">${formatCurrency(door.frame.labor)}</td>
            </tr>`;

        door.hardware.forEach((hw, hIdx) => {
            const hwSell = calculateSellPrice(hw.cost, hw.markup) * (hw.qty || 1);
            const hwLabor = (hw.labor || 0) * (hw.qty || 1);
            doorMaterials += hwSell;
            doorLabor += hwLabor;
            const hwBrand = hw.brand === 'Other' ? hw.brandManual : hw.brand;
            const hwModel = hw.model === 'Manual Entry' ? hw.modelManual : hw.model;
            html += `
            <tr>
                <td><span class="component-label">üîß Hardware</span></td>
                <td class="type-value">${hw.label || hw.type}${hw.qty > 1 ? ' <small>(√ó' + hw.qty + ')</small>' : ''}</td>
                <td class="brand-value">${hwBrand || '‚Äî'}${hwModel ? '<br/>' + hwModel : ''}</td>
                <td class="specs-value"></td>
                <td class="price-cell">${formatCurrency(hwSell)}</td>
                <td class="price-cell">${formatCurrency(hwLabor)}</td>
            </tr>`;
        });
        
        const openingTotal = (doorMaterials + doorLabor) * door.quantity;
        grandTotal += openingTotal;
        totalMaterials += doorMaterials * door.quantity;
        totalLabor += doorLabor * door.quantity;
        
        html += `
            <tr class="subtotal-row">
                <td colspan="4" style="text-align:right;">${doorLabel} Subtotal (√ó${door.quantity})</td>
                <td class="price-cell">${formatCurrency(doorMaterials * door.quantity)}</td>
                <td class="price-cell">${formatCurrency(doorLabor * door.quantity)}</td>
            </tr>
        </table>`;

        if (door.notes) {
            html += `<div class="notes-box"><strong>üìù Notes:</strong> ${door.notes}</div>`;
        }
        
        html += `</div></div>`;
        
        // Collect specs for later
        const specs = door.specs || { door: {}, frame: {}, hardware: [] };
        let hasSpecs = false;
        if ((specs.door.image || specs.door.notes) || (specs.frame.image || specs.frame.notes)) hasSpecs = true;
        if (specs.hardware && specs.hardware.some(s => s.image || s.notes)) hasSpecs = true;
        
        if (hasSpecs) {
            allSpecs.push({
                doorIdx: idx,
                doorLabel,
                quantity: door.quantity,
                doorType,
                doorBrand,
                frameType,
                frameBrand,
                doorWidth: door.door.width,
                doorHeight: door.door.height,
                specs,
                hardware: door.hardware
            });
        }
    });
    
    // TOTALS
    html += `
<div class="totals-section">
    <div class="totals-header">üí∞ ORDER TOTALS</div>
    <table class="totals-table">
        <tr>
            <td class="totals-label">Materials Subtotal</td>
            <td class="totals-amount">${formatCurrency(totalMaterials)}</td>
        </tr>
        <tr>
            <td class="totals-label">Labor Subtotal</td>
            <td class="totals-amount">${formatCurrency(totalLabor)}</td>
        </tr>
        <tr>
            <td class="totals-label">GRAND TOTAL</td>
            <td class="totals-amount">${formatCurrency(grandTotal)}</td>
        </tr>
    </table>
</div>

<div class="footer">
    <div class="footer-logo">ALOHA DOORS</div>
    <div>214 Main St. #119, El Segundo CA 90245 ‚Ä¢ (310) 414-0488 ‚Ä¢ alohadoors.com</div>
    <div style="margin-top: 5px; font-size: 8px;">Generated on ${new Date().toLocaleDateString()} at ${new Date().toLocaleTimeString()}</div>
</div>

</div>`;

    // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
    // PAGE 2+: TECHNICAL SPECIFICATIONS WITH IMAGES - EACH CATEGORY ON OWN PAGE
    // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
    
    if (allSpecs.length > 0) {
        allSpecs.forEach(specData => {
            
            // DOOR SPECIFICATIONS PAGE
            if (specData.specs.door.image || specData.specs.door.notes) {
                html += `
<div class="spec-page page-break">
    <div class="spec-page-header">
        <div>
            <div style="font-size: 20px; font-weight: 700; letter-spacing: 2px;">üö™ DOOR SPECIFICATIONS</div>
            <div style="opacity: 0.9; margin-top: 3px; font-size: 11px;">${specData.doorLabel} ‚Äî ${specData.doorType || 'Door'} ${specData.doorWidth && specData.doorHeight ? `‚Äî ${specData.doorWidth}" √ó ${specData.doorHeight}"` : ''}</div>
        </div>
        <div class="spec-page-info">
            <div class="spec-page-badge">QTY: ${specData.quantity}</div>
            <div>${job.estimateNumber || 'ESTIMATE'} ‚Ä¢ ${job.customerName || 'Customer'}</div>
        </div>
    </div>
    
    <div class="spec-content">
        <div class="spec-card">
            <div class="spec-grid">
                ${specData.specs.door.image ? `<div class="spec-image"><img src="${specData.specs.door.image}"></div>` : ''}
                ${specData.specs.door.notes ? `<div class="spec-details">${specData.specs.door.notes}</div>` : ''}
            </div>
        </div>
    </div>
    
    <div class="spec-footer">
        <strong>ALOHA DOORS</strong> ‚Ä¢ Door Specifications ‚Äî ${specData.doorLabel} ‚Ä¢ ${job.jobReference || job.estimateNumber || ''}
    </div>
</div>`;
            }
            
            // FRAME SPECIFICATIONS PAGE
            if (specData.specs.frame.image || specData.specs.frame.notes) {
                html += `
<div class="spec-page page-break">
    <div class="spec-page-header">
        <div>
            <div style="font-size: 20px; font-weight: 700; letter-spacing: 2px;">üî≤ FRAME SPECIFICATIONS</div>
            <div style="opacity: 0.9; margin-top: 3px; font-size: 11px;">${specData.doorLabel} ‚Äî ${specData.frameType || 'Frame'} ${specData.frameBrand ? `‚Äî ${specData.frameBrand}` : ''}</div>
        </div>
        <div class="spec-page-info">
            <div class="spec-page-badge">QTY: ${specData.quantity}</div>
            <div>${job.estimateNumber || 'ESTIMATE'} ‚Ä¢ ${job.customerName || 'Customer'}</div>
        </div>
    </div>
    
    <div class="spec-content">
        <div class="spec-card">
            <div class="spec-grid">
                ${specData.specs.frame.image ? `<div class="spec-image"><img src="${specData.specs.frame.image}"></div>` : ''}
                ${specData.specs.frame.notes ? `<div class="spec-details">${specData.specs.frame.notes}</div>` : ''}
            </div>
        </div>
    </div>
    
    <div class="spec-footer">
        <strong>ALOHA DOORS</strong> ‚Ä¢ Frame Specifications ‚Äî ${specData.doorLabel} ‚Ä¢ ${job.jobReference || job.estimateNumber || ''}
    </div>
</div>`;
            }
            
            // HARDWARE SPECIFICATIONS PAGES - Each hardware item on own page
            if (specData.specs.hardware && specData.specs.hardware.some(s => s.image || s.notes)) {
                specData.specs.hardware.forEach((hwSpec, hIdx) => {
                    if (hwSpec.image || hwSpec.notes) {
                        const hw = specData.hardware[hIdx];
                        const hwBrand = hw?.brand === 'Other' ? hw?.brandManual : hw?.brand;
                        const hwModel = hw?.model === 'Manual Entry' ? hw?.modelManual : hw?.model;
                        html += `
<div class="spec-page page-break">
    <div class="spec-page-header">
        <div>
            <div style="font-size: 20px; font-weight: 700; letter-spacing: 2px;">üîß HARDWARE SPECIFICATIONS</div>
            <div style="opacity: 0.9; margin-top: 3px; font-size: 11px;">${specData.doorLabel} ‚Äî ${hw?.label || 'Hardware'} ${hwBrand ? `‚Äî ${hwBrand}` : ''} ${hwModel ? `/ ${hwModel}` : ''}</div>
        </div>
        <div class="spec-page-info">
            <div class="spec-page-badge">QTY: ${specData.quantity}</div>
            <div>${job.estimateNumber || 'ESTIMATE'} ‚Ä¢ ${job.customerName || 'Customer'}</div>
        </div>
    </div>
    
    <div class="spec-content">
        <div class="spec-card">
            <div class="spec-grid">
                ${hwSpec.image ? `<div class="spec-image"><img src="${hwSpec.image}"></div>` : ''}
                ${hwSpec.notes ? `<div class="spec-details">${hwSpec.notes}</div>` : ''}
            </div>
        </div>
    </div>
    
    <div class="spec-footer">
        <strong>ALOHA DOORS</strong> ‚Ä¢ Hardware Specifications ‚Äî ${specData.doorLabel} ‚Ä¢ ${job.jobReference || job.estimateNumber || ''}
    </div>
</div>`;
                    }
                });
            }
        });
    }

    html += `</body></html>`;
    
    return html;
}

function printSpecSheet() {
    const html = generateCleanSpecSheetHTML();
    const win = window.open('', '_blank');
    if (!win) {
        alert('Please allow popups to print the spec sheet.');
        return;
    }
    win.document.write(html);
    win.document.close();
    win.onload = function() { win.print(); };
}

function saveSpecSheet() {
    const html = generateCleanSpecSheetHTML();
    const blob = new Blob([html], { type: 'text/html' });
    const url = URL.createObjectURL(blob);
    const a = document.createElement('a');
    a.href = url;
    a.download = `Aloha-Doors-${AppState.job.estimateNumber || 'SpecSheet'}-${new Date().toISOString().slice(0,10)}.html`;
    a.click();
    URL.revokeObjectURL(url);
}

function copyOrderText() {
    let text = `ALOHA DOORS - SPEC SHEET\nEstimate #: ${AppState.job.estimateNumber || '‚Äî'}\nDate: ${AppState.job.estimateDate || new Date().toLocaleDateString()}\nCustomer: ${AppState.job.customerName || '‚Äî'}\n${AppState.job.jobAddress ? 'Address: ' + AppState.job.jobAddress + '\n' : ''}${AppState.job.deliveryAddress ? 'Deliver To: ' + AppState.job.deliveryAddress + '\n' : ''}${AppState.job.jobReference ? 'Reference: ' + AppState.job.jobReference + '\n' : ''}\n`;
    const customerName = AppState.job.customerName || '';
    AppState.doors.forEach((door, idx) => {
        const doorLabel = customerName ? `${customerName} - Door ${idx + 1}` : `Door #${idx + 1}`;
        text += `‚ïê‚ïê‚ïê ${doorLabel} ‚Äî QTY: ${door.quantity} ‚ïê‚ïê‚ïê\n`;
        text += `DOOR: ${getDoorTypeLabel(door.door.type) || '‚Äî'} | ${door.door.brand || '‚Äî'}\n  Size: ${door.door.width}"√ó${door.door.height}"√ó${door.door.thickness}" | Fire: ${door.door.fireRating}\n`;
        text += `FRAME: ${getFrameTypeLabel(door.frame.type) || '‚Äî'} | ${door.frame.brand || '‚Äî'}\n  Material: ${door.frame.material} | Anchors: ${door.frame.anchors}\n`;
        if (door.hardware.length > 0) { text += `HARDWARE:\n`; door.hardware.forEach(hw => { text += `  ‚Ä¢ ${hw.label} - ${hw.brand || '‚Äî'}${hw.qty > 1 ? ' √ó' + hw.qty : ''}\n`; }); }
        if (door.notes) text += `NOTES: ${door.notes}\n`; text += '\n';
    });
    navigator.clipboard.writeText(text).then(() => alert('‚úì Copied!'));
}

function importJSON(event) {
    const file = event.target.files[0]; if (!file) return;
    const reader = new FileReader();
    reader.onload = function(e) {
        try {
            const data = JSON.parse(e.target.result);
            if (data.job) AppState.job = data.job;
            if (data.doors?.length > 0) { AppState.doors = data.doors; AppState.activeIndex = 0; }
            if (data.savedConfigurations) Object.assign(SavedConfigurations, data.savedConfigurations);
            renderTabs(); loadDoorToForm(); alert('‚úì Loaded!');
        } catch (err) { alert('Error: ' + err.message); }
    };
    reader.readAsText(file); event.target.value = '';
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// CONFIGURATIONS - Now includes specs!
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê

function openConfigModal() { document.getElementById('configModal').classList.add('active'); renderSavedConfigs(); }
function closeConfigModal() { document.getElementById('configModal').classList.remove('active'); }

function saveCurrentConfig() { 
    const name = document.getElementById('configName').value.trim(); 
    if (!name) { alert('Enter a name.'); return; } 
    const door = AppState.doors[AppState.activeIndex]; 
    
    // Save everything EXCEPT quantity
    SavedConfigurations[name] = { 
        door: JSON.parse(JSON.stringify(door.door)), 
        frame: JSON.parse(JSON.stringify(door.frame)), 
        hardware: JSON.parse(JSON.stringify(door.hardware)),
        specs: JSON.parse(JSON.stringify(door.specs || { door: {}, frame: {}, hardware: [] })),
        notes: door.notes,
        savedAt: new Date().toISOString() 
    }; 
    document.getElementById('configName').value = ''; 
    renderSavedConfigs(); 
    alert(`‚úì "${name}" saved with spec sheets!`); 
}

function loadConfig(name) { 
    const config = SavedConfigurations[name]; 
    if (!config) return; 
    const door = AppState.doors[AppState.activeIndex]; 
    const currentQty = door.quantity; // Preserve quantity
    
    Object.assign(door.door, config.door); 
    Object.assign(door.frame, config.frame); 
    door.hardware = JSON.parse(JSON.stringify(config.hardware));
    door.specs = JSON.parse(JSON.stringify(config.specs || { door: {}, frame: {}, hardware: [] }));
    door.notes = config.notes || '';
    door.quantity = currentQty; // Keep original quantity
    
    loadDoorToForm(); 
    closeConfigModal(); 
    alert(`‚úì "${name}" loaded! Quantity unchanged.`); 
}

function deleteConfig(name) { if (confirm(`Delete "${name}"?`)) { delete SavedConfigurations[name]; renderSavedConfigs(); } }

function renderSavedConfigs() { 
    const container = document.getElementById('savedConfigsList'); 
    const configs = Object.keys(SavedConfigurations); 
    if (configs.length === 0) { container.innerHTML = '<p style="color:#9ca3af; text-align:center; padding:20px;">No saved configurations</p>'; return; } 
    container.innerHTML = configs.map(name => { 
        const c = SavedConfigurations[name]; 
        const hasSpecs = c.specs && ((c.specs.door?.image || c.specs.door?.notes) || (c.specs.frame?.image || c.specs.frame?.notes) || (c.specs.hardware?.some(s => s.image || s.notes)));
        return `<div style="border:1px solid #e5e7eb; border-radius:8px; padding:15px; margin-bottom:10px; display:flex; justify-content:space-between; align-items:center;">
            <div>
                <div style="font-weight:600;">${name} ${hasSpecs ? 'üìã' : ''}</div>
                <div style="font-size:12px; color:#6b7280;">${c.door?.type || '‚Äî'} | ${c.frame?.type || '‚Äî'} | ${c.hardware?.length || 0} hw</div>
            </div>
            <div style="display:flex; gap:8px;">
                <button class="btn btn-success btn-sm" onclick="loadConfig('${name}')">Load</button>
                <button class="btn btn-danger btn-sm" onclick="deleteConfig('${name}')">Delete</button>
            </div>
        </div>`; 
    }).join(''); 
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// EMAIL SYSTEM
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê

function openEmailModal() {
    const job = AppState.job;
    const door = AppState.doors[AppState.activeIndex];
    
    // Pre-fill subject
    const subject = `Aloha Doors Order - ${job.customerName || 'Customer'} - ${job.jobReference || job.estimateNumber}`;
    document.getElementById('emailSubject').value = subject;
    
    // Pre-fill body with order summary
    let body = `Hello,\n\nPlease find attached the door order specification sheet for:\n\n`;
    body += `Customer: ${job.customerName || '‚Äî'}\n`;
    body += `Estimate #: ${job.estimateNumber}\n`;
    body += `Job Reference: ${job.jobReference || '‚Äî'}\n`;
    body += `Date: ${job.estimateDate}\n\n`;
    
    // Add door summary
    body += `ORDER SUMMARY:\n`;
    body += `‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ\n`;
    
    AppState.doors.forEach((d, idx) => {
        const doorType = d.door.type ? getDoorTypeLabel(d.door.type) : 'Not specified';
        const size = (d.door.width && d.door.height) ? `${d.door.width}" √ó ${d.door.height}"` : 'Size TBD';
        body += `\nDoor #${idx + 1} (Qty: ${d.quantity})\n`;
        body += `  Type: ${doorType}\n`;
        body += `  Size: ${size}\n`;
        if (d.door.brand) body += `  Brand: ${d.door.brand}\n`;
        if (d.door.fireRating && d.door.fireRating !== 'None') body += `  Fire Rating: ${d.door.fireRating}\n`;
        if (d.hardware.length > 0) {
            body += `  Hardware: ${d.hardware.map(h => h.label).join(', ')}\n`;
        }
    });
    
    body += `\n‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ\n\n`;
    body += `Please see the attached specification sheet for complete details including technical specifications and images.\n\n`;
    body += `Thank you,\n`;
    body += `Aloha Doors\n`;
    
    document.getElementById('emailBody').value = body;
    document.getElementById('emailTo').value = '';
    document.getElementById('emailCc').value = '';
    
    document.getElementById('emailModal').classList.add('active');
}

function closeEmailModal() {
    document.getElementById('emailModal').classList.remove('active');
}

function sendEmail() {
    const to = document.getElementById('emailTo').value.trim();
    const cc = document.getElementById('emailCc').value.trim();
    const subject = document.getElementById('emailSubject').value.trim();
    const body = document.getElementById('emailBody').value;
    
    if (!to) {
        alert('Please enter a recipient email address.');
        return;
    }
    
    // First, download the spec sheet so user can attach it
    saveSpecSheet();
    
    // Build mailto URL
    let mailtoUrl = `mailto:${encodeURIComponent(to)}`;
    const params = [];
    
    if (cc) params.push(`cc=${encodeURIComponent(cc)}`);
    if (subject) params.push(`subject=${encodeURIComponent(subject)}`);
    if (body) params.push(`body=${encodeURIComponent(body)}`);
    
    if (params.length > 0) {
        mailtoUrl += '?' + params.join('&');
    }
    
    // Open email client
    window.location.href = mailtoUrl;
    
    // Close modal after short delay
    setTimeout(() => {
        closeEmailModal();
        alert('‚úì Email client opened!\n\nPlease attach the downloaded spec sheet file to your email.');
    }, 500);
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// PRESET SYSTEM
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê

function getPresets() {
    try {
        return JSON.parse(localStorage.getItem('alohaDoorsPresets') || '{}');
    } catch (e) {
        return {};
    }
}

function savePresetsToStorage(presets) {
    localStorage.setItem('alohaDoorsPresets', JSON.stringify(presets));
}

function populatePresetDropdown() {
    const select = document.getElementById('presetSelector');
    const presets = getPresets();
    const names = Object.keys(presets).sort();
    
    select.innerHTML = '<option value="">‚Äî Load Preset ‚Äî</option>';
    names.forEach(name => {
        const opt = document.createElement('option');
        opt.value = name;
        opt.textContent = name;
        select.appendChild(opt);
    });
}

function openSavePresetModal() {
    const door = AppState.doors[AppState.activeIndex];
    if (!door) return;
    
    // Generate preview
    const preview = document.getElementById('presetPreview');
    let previewHTML = '<strong>Door:</strong> ' + (door.door.type ? getDoorTypeLabel(door.door.type) : 'Not set');
    if (door.door.width && door.door.height) {
        previewHTML += ` (${door.door.width}" √ó ${door.door.height}")`;
    }
    if (door.door.brand) previewHTML += ' - ' + door.door.brand;
    
    previewHTML += '<br><strong>Frame:</strong> ' + (door.frame.type ? getFrameTypeLabel(door.frame.type) : 'Not set');
    if (door.frame.brand) previewHTML += ' - ' + door.frame.brand;
    
    previewHTML += '<br><strong>Hardware:</strong> ' + (door.hardware.length > 0 ? door.hardware.map(h => h.label).join(', ') : 'None');
    
    const hasImages = door.specs.door.image || door.specs.frame.image || (door.specs.hardware && door.specs.hardware.some(h => h.image));
    previewHTML += '<br><strong>Images:</strong> ' + (hasImages ? '‚úì Included' : 'None');
    
    preview.innerHTML = previewHTML;
    
    // Clear name field
    document.getElementById('presetName').value = '';
    
    // Show modal
    document.getElementById('savePresetModal').classList.add('active');
}

function closeSavePresetModal() {
    document.getElementById('savePresetModal').classList.remove('active');
}

function savePreset() {
    const name = document.getElementById('presetName').value.trim();
    if (!name) {
        alert('Please enter a preset name.');
        return;
    }
    
    const door = AppState.doors[AppState.activeIndex];
    if (!door) return;
    
    const presets = getPresets();
    
    // Check if name exists
    if (presets[name]) {
        if (!confirm(`Preset "${name}" already exists. Overwrite?`)) return;
    }
    
    // Save preset (excluding job info and quantity)
    presets[name] = {
        door: JSON.parse(JSON.stringify(door.door)),
        frame: JSON.parse(JSON.stringify(door.frame)),
        hardware: JSON.parse(JSON.stringify(door.hardware)),
        specs: JSON.parse(JSON.stringify(door.specs)),
        notes: door.notes,
        savedAt: new Date().toISOString()
    };
    
    savePresetsToStorage(presets);
    populatePresetDropdown();
    closeSavePresetModal();
    
    // Select the newly saved preset
    document.getElementById('presetSelector').value = name;
    
    alert(`‚úì Preset "${name}" saved!`);
}

function loadPreset(name) {
    if (!name) return;
    
    const presets = getPresets();
    const preset = presets[name];
    if (!preset) {
        alert('Preset not found.');
        return;
    }
    
    const door = AppState.doors[AppState.activeIndex];
    if (!door) return;
    
    // Keep current quantity
    const currentQty = door.quantity;
    
    // Load preset data
    door.door = JSON.parse(JSON.stringify(preset.door));
    door.frame = JSON.parse(JSON.stringify(preset.frame));
    door.hardware = JSON.parse(JSON.stringify(preset.hardware));
    door.specs = JSON.parse(JSON.stringify(preset.specs));
    door.notes = preset.notes || '';
    
    // Restore quantity
    door.quantity = currentQty;
    
    // Reload form
    loadDoorToForm();
    
    alert(`‚úì Preset "${name}" loaded! Quantity unchanged.`);
}

function deleteCurrentPreset() {
    const select = document.getElementById('presetSelector');
    const name = select.value;
    
    if (!name) {
        alert('Please select a preset to delete.');
        return;
    }
    
    if (!confirm(`Delete preset "${name}"?`)) return;
    
    const presets = getPresets();
    delete presets[name];
    savePresetsToStorage(presets);
    populatePresetDropdown();
    
    alert(`‚úì Preset "${name}" deleted.`);
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// INIT
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê

document.addEventListener('DOMContentLoaded', function() {
    AppState.job.estimateDate = new Date().toISOString().slice(0, 10);
    AppState.job.estimateNumber = 'EST-' + Date.now().toString().slice(-6);
    AppState.doors.push(createNewDoor());
    populateBrandDropdown('doorBrand', 'doors');
    populateBrandDropdown('frameBrand', 'frames');
    populatePresetDropdown();
    renderTabs(); 
    loadDoorToForm();
});
</script>
</body>
</html>
